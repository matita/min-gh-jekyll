---
title: "Introducing Background Sync | Web Updates - Google Developers"
description: "Background sync is a new web API that lets you defer actions until the user has stable connectivity. This is useful for ensuring that whatever the user wants to send, is actually sent."
link: "https://developers.google.com/web/updates/2015/12/background-sync"
saved: "2015-12-16 16:51:35"
---
<p class="intro">Background sync is a new web API that lets you defer actions until the user has stable connectivity. This is useful for ensuring that whatever the user wants to send, is actually sent.</p><h2 id="the-problem">The problem</h2><p>The internet is a great place to waste time. Without wasting time on the internet, we wouldn’t know <a href="https://www.youtube.com/watch?v=-Z4jx5VMw8M">cats dislike flowers</a>, <a href="https://www.youtube.com/watch?v=PrjkqW37n_k">chameleons love bubbles</a>, and “You do What They Told Ya” as sung by “Rage Against the Machine” <a href="https://youtu.be/W4BzJm4-Wo0?t=14s">sounds like the Japanese for, “Break the chicken nugget, daddy”</a>.</p><p>But sometimes, just sometimes, we’re not looking to waste time. The desired user experience is more like:</p><ol><li>Phone out of pocket.</li><li>Achieve minor goal.</li><li>Phone back in pocket.</li><li>Resume life.</li></ol><p>Unfortunately this experience is frequently broken by poor connectivity. We’ve all been there. You’re staring at a white screen or a spinner, and you know you should just give up and get on with your life, but you give it another 10 seconds just in case. After that 10 seconds? Nothing. But why give up now? You’ve invested time already, so walking away with nothing would be a waste, so you carry on waiting. By this point you <em>want</em> to give up, but you know the second you do so, is the second before everything would have loaded if only you’d waited.</p><p><a href="https://developers.google.com/web/updates/2015/11/app-shell">Service workers</a> solve the page loading part by letting you serve content from a cache. But what about when the page needs to send something to the server?</p><p>At the moment, if the user hits “send” on a message they have to stare at a spinner until it completes. If they try to navigate away or close the tab, we use <a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowEventHandlers/onbeforeunload"><code>onbeforeunload</code></a> to display a message like, “Nope, I need you to stare at this spinner some more. Sorry”. If the user has no connection we tell the user “Sorry, <em>you</em> must come back later and try again”.</p><p>This is rubbish. Background sync lets you do better.</p><h2 id="the-solution">The solution</h2><p>The following video shows <a href="https://jakearchibald-gcm.appspot.com/">Emojoy</a>, a simple emoji-only chat demo… thing. It’s a <a href="https://infrequently.org/2015/06/progressive-apps-escaping-tabs-without-losing-our-soul/">progressive app</a>. It works offline-first. It uses push messages and notifications, and it uses background sync.</p><p>If the user tries to send a message when they have zero connectivity, then, thankfully, the message is sent in the background once they get connectivity.</p><div class="video-wrapper"><iframe src="https://www.youtube.com/embed/l4e_LFozK2k?controls=2&amp;modestbranding=1&amp;showinfo=0&amp;utm-source=crdev-wf" class="devsite-embedded-youtube-video" allowfullscreen="" data-video-id="l4e_LFozK2k" data-autohide="1" data-modestbranding="1" data-controls="2" data-utm-source="crdev-wf" data-showinfo="0" frameborder="0"></iframe></div><p>Background sync hasn’t hit the main release of Chrome yet, so if you want to try this you’ll need either <a href="https://play.google.com/store/apps/details?id=com.chrome.dev&amp;hl=en">Chrome Dev for Android</a>, or <a href="https://www.google.com/chrome/browser/canary.html">Chrome Canary for desktop</a>. You’ll also need to enable <code>chrome://flags/#enable-experimental-web-platform-features</code> and restart the browser. Then:</p><ol><li><a href="https://jakearchibald-gcm.appspot.com/">Open Emojoy</a>.</li><li>Go offline (either using airplane-mode or visit your local Faraday cage).</li><li>Type a message.</li><li>Go back to your homescreen (optionally close the tab/browser).</li><li>Go online.</li><li>Message sends in the background!</li></ol><p>Being able to send in the background like this also yields a perceived performance improvement. The app doesn’t need to make such a big deal about the message sending, so it can add the message to the output straight away.</p><h2 id="how-to-request-a-background-sync">How to request a background sync</h2><p>In true <a href="https://extensiblewebmanifesto.org/">extensible web</a> style, this is a low level feature that gives you the freedom to do what you need. You ask for an event to be fired when the user has connectivity, which is immediate if the user already has connectivity. Then, you listen for that event and do whatever you need to do.</p><p>Like push messaging, it uses a <a href="http://www.html5rocks.com/en/tutorials/service-worker/introduction/">service worker</a> as the event target, which enables it to work when the page isn’t open. To begin, register for a sync from a page:</p><div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// Register your service worker:</span>
<span class="nx">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">'/sw.js'</span><span class="p">);</span>

<span class="c1">// Then later, request a one-off sync:</span>
<span class="nx">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">ready</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">swRegistration</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">swRegistration</span><span class="p">.</span><span class="nx">sync</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">'myFirstSync'</span><span class="p">);</span>
<span class="p">});</span></code></pre></div><p>Then listen for the event in <code>/sw.js</code>:</p><div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">self</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'sync'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">tag</span> <span class="o">==</span> <span class="s1">'myFirstSync'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">waitUntil</span><span class="p">(</span><span class="nx">doSomeStuff</span><span class="p">());</span>
  <span class="p">}</span>
<span class="p">});</span></code></pre></div><p>And that’s it! In the above, <code>doSomeStuff()</code> should return a promise indicating the success/failure of whatever it’s trying to do. If it fulfills, the sync is complete. If it fails, another sync will be scheduled to retry. Retry syncs also wait for connectivity, and employ an exponential back-off.</p><p>The tag name of the sync (‘myFirstSync’ in the above example) should be unique for a given sync. If you register for a sync using the same tag as a pending sync, it coalesces with the existing sync. That means you can register for an “clear-outbox” sync every time the user sends a message, but if they send 5 messages while offline, you’ll only get one sync when they become online. If you want 5 separate sync events, just use unique tags!</p><p><a href="https://jakearchibald.github.io/isserviceworkerready/demos/sync/">Here’s a simple demo</a> that does the bare minimum; it uses the sync event to show a notification.</p><h2 id="what-could-i-use-background-sync-for">What could I use background sync for?</h2><p>Ideally, you’d use it to schedule any data sending that you care about beyond the life of the page. Chat messages, emails, document updates, settings changes, photo uploads… anything that you want to reach the server even if user navigates away or closes the tab. The page could store these in an “outbox” store in indexedDB, and the service worker would retrieve them, and send them.</p><p>Although, you could also use it to fetch small bits of data…</p><h3 id="another-demo">Another demo!</h3><div class="video-wrapper"><iframe src="https://www.youtube.com/embed/oiVyIT7ljC0?controls=2&amp;modestbranding=1&amp;showinfo=0&amp;utm-source=crdev-wf" class="devsite-embedded-youtube-video" allowfullscreen="" data-video-id="oiVyIT7ljC0" data-autohide="1" data-modestbranding="1" data-controls="2" data-utm-source="crdev-wf" data-showinfo="0" frameborder="0"></iframe></div><p>This is the <a href="https://wiki-offline.jakearchibald.com/">offline wikipedia</a> demo I created for <a href="https://www.youtube.com/watch?v=d5_6yHixpsQ">Supercharging Page Load</a>. I’ve since added some background sync magic to it.</p><p>Try this out yourself. As before make sure you’re in <a href="https://play.google.com/store/apps/details?id=com.chrome.dev&amp;hl=en">Chrome Dev for Android</a>, or <a href="https://www.google.com/chrome/browser/canary.html">Chrome Canary for desktop</a> with <code>chrome://flags/#enable-experimental-web-platform-features</code>.</p><ol><li>Go to any article, perhaps <a href="https://wiki-offline.jakearchibald.com/wiki/Google_Chrome">Chrome</a>.</li><li>Go offline (either using airplane-mode or join a terrible mobile provider like I have).</li><li>Click a link to another article.</li><li>You should be told the page failed to load (this will also appear if the page just takes a while to load).</li><li>Agree to notifications.</li><li>Close the browser.</li><li>Go online</li><li>You get notified when the article is downloaded, cached, and ready to view!</li></ol><p>Using this pattern, the user can put their phone in their pocket and get on with their life, knowing the phone will alert them when it’s fetched want they wanted.</p><h2 id="permissions">Permissions</h2><p>The demos I’ve shown use <a href="https://notifications.spec.whatwg.org/">web notifications</a>, which require permission, but background sync itself does not.</p><p>Sync events will often complete while the user has a page open to the site, so requiring user permission would be a poor experience. Instead, we’re limiting when syncs can be registered and triggered to prevent abuse. E.g.:</p><ul><li>You can only register for a sync event when the user has a window open to the site.</li><li>The event execution time is capped, so you can’t use them to ping a server every x seconds, mine bitcoins or whatever.</li></ul><p>Of course, these restrictions may loosen/tighten based on real-world usage.</p><h2 id="progressive-enhancement">Progressive Enhancement</h2><p>It’ll be a while before all browsers support background sync, especially as Safari and Edge don’t yet support service workers. But progressive enhancement helps here:</p><div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">if</span> <span class="p">(</span><span class="s1">'serviceWorker'</span> <span class="k">in</span> <span class="nx">navigator</span> <span class="o">&amp;&amp;</span> <span class="s1">'SyncManager'</span> <span class="k">in</span> <span class="nb">window</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">navgiator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">ready</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">reg</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">reg</span><span class="p">.</span><span class="nx">sync</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">'tag-name'</span><span class="p">);</span>
  <span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// system was unable to register for a sync,</span>
    <span class="c1">// this could be an OS-level restriction</span>
    <span class="nx">postDataFromThePage</span><span class="p">();</span>
  <span class="p">});</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="c1">// serviceworker/sync not supported</span>
  <span class="nx">postDataFromThePage</span><span class="p">();</span>
<span class="p">}</span></code></pre></div><p>If service workers or background sync aren’t available, just post the content from the page as you’d do today.</p><p>Note that it’s worth using background sync even if the user appears to have good connectivity, as it protects you against navigations and tab closures during data send.</p><h2 id="the-future">The future</h2><p>We’re aiming to ship background sync to a stable version of Chrome in the first half of 2016. But we’re also working on a variant, “periodic background sync”. This will allow you to request a “periodicsync” event restricted by time interval, battery state and network state. This would require user permission, of course, but it will also be down to the will of the browser for when and how often these events fire. E.g., a news site could request to sync every hour, but the browser may know you only read that site at 07:00, so the sync would fire daily at 06:50. This idea is a little further off than one-off syncing, but it’s coming.</p><p>Bit by bit we’re bringing successful patterns from Android/iOS onto the web, while still retaining what makes the web great!</p><div class="wf-author__container mdl-grid page-content"><h6 class="mdl-cell--12-col">Authors</h6><div class="wf-author__row mdl-cell mdl-cell--6-col mdl-cell--4-col-tablet"><div class="wf-author__img-container"><img class="wf-author__profile-photo" src="https://developers.google.com/web/imgs/contributors/jakearchibald.jpg" alt="Profile photo of Jake Archibald"></div><div class="wf-author__info"><div class="wf-author__name"><a href="http://jakearchibald.com/" target="_blank" title="Jake Archibald's Homepage">Jake Archibald</a></div><p></p></div></div></div><div class="wf-license-translation page-content"><p class="wf-cc-license">Except as otherwise noted, the content of this page is licensed under the <a href="http://creativecommons.org/licenses/by/3.0/" itemprop="license">Creative Commons Attribution 3.0 License</a>, and code samples are licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 License</a>. For details, see our <a href="https://developers.google.com/site-terms">Terms of Service</a>.</p><button id="language-selection-menu" aria-label="Language selector" class="mdl-button mdl-js-button mdl-button--icon wf-btn__small" data-upgraded=",MaterialButton"><svg fill="#000000" height="48" viewBox="0 0 24 24" width="48" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zm6.93 6h-2.95c-.32-1.25-.78-2.45-1.38-3.56 1.84.63 3.37 1.91 4.33 3.56zM12 4.04c.83 1.2 1.48 2.53 1.91 3.96h-3.82c.43-1.43 1.08-2.76 1.91-3.96zM4.26 14C4.1 13.36 4 12.69 4 12s.1-1.36.26-2h3.38c-.08.66-.14 1.32-.14 2 0 .68.06 1.34.14 2H4.26zm.82 2h2.95c.32 1.25.78 2.45 1.38 3.56-1.84-.63-3.37-1.9-4.33-3.56zm2.95-8H5.08c.96-1.66 2.49-2.93 4.33-3.56C8.81 5.55 8.35 6.75 8.03 8zM12 19.96c-.83-1.2-1.48-2.53-1.91-3.96h3.82c-.43 1.43-1.08 2.76-1.91 3.96zM14.34 14H9.66c-.09-.66-.16-1.32-.16-2 0-.68.07-1.35.16-2h4.68c.09.65.16 1.32.16 2 0 .68-.07 1.34-.16 2zm.25 5.56c.6-1.11 1.06-2.31 1.38-3.56h2.95c-.96 1.65-2.49 2.93-4.33 3.56zM16.36 14c.08-.66.14-1.32.14-2 0-.68-.06-1.34-.14-2h3.38c.16.64.26 1.31.26 2s-.1 1.36-.26 2h-3.38z"></path></svg></button><div class="mdl-menu__container is-upgraded"><ul class="mdl-menu mdl-menu--top-right mdl-js-menu mdl-js-ripple-effect mdl-js-ripple-effect--ignore-events" for="language-selection-menu" data-upgraded=",MaterialMenu,MaterialRipple"><li class="mdl-menu__item mdl-js-ripple-effect" tabindex="-1" data-upgraded=",MaterialRipple"><a class="wf-translation-link__link" href="https://developers.google.com/web/updates/2015/12/background-sync?hl=en">English</a><span class="mdl-menu__item-ripple-container"><span class="mdl-ripple"></span></span></li></ul></div></div>