---
title: "A Guide to Proper Error Handling in JavaScript"
description: "Camilo Reyes explains the best practices for proper error handling in JavaScript, including how to deal with errors thrown by asynchronous code."
link: "http://www.sitepoint.com/proper-error-handling-javascript/"
saved: "2016-04-19 14:29:31"
---

    <p><em>This article was peer reviewed by <a href="http://www.sitepoint.com/author/tseverien/">Tim Severien</a> and <a href="http://www.sitepoint.com/author/morkro/">Moritz Kröger</a>. Thanks to all of SitePoint’s peer reviewers for making SitePoint content the best it can be!</em></p>
<p>Ah, the perils of error handling in JavaScript. If you believe <a href="https://en.wikipedia.org/wiki/Murphy%27s_law">Murphyʼs law</a>, anything that can go wrong, will go wrong! In this article I would like to explore error handling in JavaScript. I will cover pitfalls and good practices. We’ll finish by looking at asynchronous code and Ajax.</p>
<div class="ArticleBox u-inline"><h3 class="ArticleBox_header t-bg">
                    <span class="ArticleBox_icon fa fa-pencil"></span> More from this author
                 </h3><div class="ArticleBox_content"><ul class="ArticleBox_list t-list"><li><a href="http://www.sitepoint.com/a-beginner-splurge-in-node-js/?utm_source=sitepoint&amp;utm_medium=relatedinline&amp;utm_term=javascript&amp;utm_campaign=relatedauthor">A Beginner Splurge in Node.js</a></li><li><a href="http://www.sitepoint.com/guide-vanilla-ajax-without-jquery/?utm_source=sitepoint&amp;utm_medium=relatedinline&amp;utm_term=javascript&amp;utm_campaign=relatedauthor">A Guide to Vanilla Ajax Without jQuery</a></li></ul></div></div>
<p>I feel JavaScriptʼs event-driven paradigm adds richness to the language. I like to imagine the browser as this event-driven machine, and errors are no different. When an error occurs, an event gets thrown at some point. In theory, one could argue errors are simple events in JavaScript. If this sounds foreign to you, buckle up as you are in for quite a ride. For this article, I will focus only on client-side JavaScript.</p>
<p>This write up will build on concepts explained in the article <a href="http://www.sitepoint.com/exceptional-exception-handling-in-javascript/">Exceptional Exception Handling in JavaScript</a>. To paraphrase: “with an exception JavaScript checks for exception handling up the call stack.” I recommend reading up on the basics if you are not familiar. My goal is to explore beyond the bare necessities for handling exceptions. The next time you see a nice <code class=" language-javascript"><span class="token keyword">try</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">catch</span></code> block, it will make you think twice. </p>
<h2 id="thedemo">The Demo</h2>
<p>The demo we’ll be using for this article is available on <a href="https://github.com/sitepoint-editors/ProperErrorHandlingJavaScript">GitHub</a>, and presents a page like this:</p>
<p><img src="http://dab1nmslvvntp.cloudfront.net/wp-content/uploads/2016/02/1455237011proper_error_handling_javascript_1.jpg" alt="Error handling in JavaScript demo"></p>
<p>All buttons detonate a “bomb” when clicked. This bomb simulates an exception that gets thrown as a <code class=" language-javascript">TypeError</code>. Below is the definition of such a module with unit test.</p>
<pre class=" language-javascript"><code class="javascript  language-javascript"><span class="token keyword">function</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> foo<span class="token punctuation">.</span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>To begin, this function declares an empty empty object named <code class=" language-javascript">foo</code>. Note that <code class=" language-javascript"><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code> does not get a definition anywhere. Let’s verify that this will detonate a bomb with a nice unit test.</p>
<pre class=" language-javascript"><code class="javascript  language-javascript"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'throws a TypeError'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    should<span class="token punctuation">.</span><span class="token function">throws</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> TypeError<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>This unit test is written in <a href="http://mochajs.org/">Mocha</a> with test assertions in <a href="http://shouldjs.github.io/">Should.js</a>. Mocha is a test runner while should.js is the assertion library. Feel free to explore these test APIs if you are not already familiar. A test begins with <code class=" language-javascript"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'description'</span><span class="token punctuation">)</span></code> and ends with a pass / fail in <code class=" language-javascript">should</code>. The good news is unit tests run on node and do not need a browser. I recommend paying attention to the tests as they prove out key concepts in plain JavaScript.</p>
<p>As shown, <code class=" language-javascript"><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code> defines an empty object then tries to access a method. Because <code class=" language-javascript"><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code> does not exist within the object it throws an exception. Believe me, with a dynamic language like JavaScript this can happen to anybody!</p>
<h2 id="thebad">The Bad</h2>
<p>On to some bad error handling. I have abstracted the handler on the button from the implementation. Here is what the handler looks like with unit tests:</p>
<pre class=" language-javascript"><code class="javascript  language-javascript"><span class="token keyword">function</span> <span class="token function">badHandler</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>This handler receives a <code class=" language-javascript">fn</code> callback as a dependency. This dependency then gets called inside the handler function. The unit tests show how it is used.</p>
<pre class=" language-javascript"><code class="javascript  language-javascript"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'returns a value without errors'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> fn <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token function">target</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    result<span class="token punctuation">.</span>should<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'returns a null with errors'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> fn <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">'random error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token function">target</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">should</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>As you can see, this wicked handler returns <code class=" language-javascript"><span class="token keyword">null</span></code> if something goes wrong. The callback <code class=" language-javascript"><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code> can point to a legit method or a bomb. The click handler below tells the rest of the story.</p>
<pre class=" language-javascript"><code class="javascript  language-javascript"><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>handler<span class="token punctuation">,</span> bomb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> badButton <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'bad'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>badButton<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        badButton<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">handler</span><span class="token punctuation">(</span>bomb<span class="token punctuation">)</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Imagine, getting promoted for hiding mistakes'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span>badHandler<span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>What stinks is I just get a <code class=" language-javascript"><span class="token keyword">null</span></code>. This leaves me blind when I try to figure out what went wrong. This fail-silent strategy can range from bad UX all the way down to data corruption. What is frustrating with this is I can spend hours debugging the symptom but miss the try-catch block. This wicked handler swallows mistakes in the code and pretends all is well. This may go down well with organizations that donʼt sweat code quality. But, hiding mistakes will find you debugging for hours in the future. In a multi-layered solution with deep call stacks, it is impossible to figure out where it went wrong. There may be a few cases where doing a silent try-catch is legit. But as far as error handling, this is just bad.</p>
<p>A fail-silent strategy will leave you pining for better error handling. JavaScript offers a more elegant way of dealing with these types of issues.</p>
<h2 id="theugly">The Ugly</h2>
<p>Moving on, time to investigate an ugly handler. I will skip the part that gets tight-coupled to the DOM. There is no difference here from the bad handler we just saw. What matters is the way it handles exceptions as shown below with unit test.</p>
<pre class=" language-javascript"><code class="javascript  language-javascript"><span class="token keyword">function</span> <span class="token function">uglyHandler</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">'a new error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'returns a new error with errors'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> fn <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">'type error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    should<span class="token punctuation">.</span><span class="token function">throws</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">target</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> Error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>A definite improvement over the bad handler. Here the exception gets bubbled up the call stack. What I like is now errors will <em>unwind the stack</em> which is super helpful in debugging. With an exception, the interpreter will travel up the stack looking for another handler. This opens many opportunities to deal with errors at the top of the call stack. Unfortunately, since it is an ugly handler I lose the original error. So I am forced to traverse back down the stack to figure out the original exception. But at least I know something went wrong, which is the point of throwing an exception.</p>
<p>The ugly error handler is not as harmful but leads to code smell. Letʼs see if the browser has something up its sleeve to deal with this.</p>
<h2 id="unwindthatstack">Unwind that Stack</h2>
<p>So, one way to unwind exceptions is to place a <code class=" language-javascript"><span class="token keyword">try</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">catch</span></code> at the top of the call stack. Say:</p>
<pre class=" language-javascript"><code class="javascript  language-javascript"><span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span>bomb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token function">bomb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// Handle all the error things</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>But, remember I said that the browser is event-driven? Yes, an exception in JavaScript is no more than an event. The interpreter halts execution in the current executing context and unwinds. Turns out, there is an <code class=" language-javascript">onerror</code> global event handler we can leverage. And it goes something like this:</p>
<pre class=" language-javascript"><code class="javascript  language-javascript">window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> error <span class="token operator">=</span> e<span class="token punctuation">.</span>error<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>This event handler catches errors within any executing context. Error events get fired from various targets for any kind of error. What is so radical is this event handler centralizes error handling in the code. Just like with any other event, you can daisy chain handlers to handle specific errors. This allows error handlers to have a single purpose, if you follow <a href="https://en.wikipedia.org/wiki/SOLID_" title="object-oriented_design">SOLID</a> principles. These handlers can get registered at any time. The interpreter will cycle through as many handlers as it needs to. The code base gets freed from <code class=" language-javascript"><span class="token keyword">try</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">catch</span></code> blocks that get peppered all over which makes it easy to debug. The key is to treat error handling like event handling in JavaScript.</p>
<p>Now that there is a way to unwind the stack with global handlers, what can we do with that? After all, may the call stack be with you.</p>
<h2 id="capturethestack">Capture the Stack</h2>
<p>The call stack is super helpful in troubleshooting issues. The good news is that the browser provides this information out of the box. Granted, the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error/Stack">stack</a> property in the error object is not part of the standard yet, but it is consistently available in the latest browsers. </p>
<p>So, one of the cool things we can do with this is log it to the server:</p>
<pre class=" language-javascript"><code class="javascript  language-javascript">window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> stack <span class="token operator">=</span> e<span class="token punctuation">.</span>error<span class="token punctuation">.</span>stack<span class="token punctuation">;</span>
    <span class="token keyword">var</span> message <span class="token operator">=</span> e<span class="token punctuation">.</span>error<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>stack<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        message <span class="token operator">+</span><span class="token operator">=</span> <span class="token string">'\n'</span> <span class="token operator">+</span> stack<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token string">'/log'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>It may not be obvious from the code sample, but this event handler will fire along side the one I just showed above. As mentioned, every handler gets a single purpose which keeps the code <a href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself">DRY</a>. What I like is how these messages get captured on the server. </p>
<p>Here is a screen shot of what this looks like in node:</p>
<p><img src="http://dab1nmslvvntp.cloudfront.net/wp-content/uploads/2016/02/1455237138proper_error_handling_javascript_2.jpg" alt="Ajax log request to node server"></p>
<p>This message comes from Firefox Developer Edition 46. With a proper error handler, note that it is crystal clear what the issue is. No need to hide mistakes here! Just by glancing at this, I can see what threw the exception and where. This level of transparency is awesome for debugging front-end code. These messages can get stored in persistent storage for later retrieval, giving further insight on what conditions trigger which errors.</p>
<p>The call stack is super helpful for debugging. Never underestimate the power of the call stack.</p>
<h2 id="asynchandling">Async Handling</h2>
<p>Ah, the perils of asynchrony! JavaScript rips asynchronous code out of the current executing context. This means <code class=" language-javascript"><span class="token keyword">try</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">catch</span></code> statements such as the one below have a problem.</p>
<pre class=" language-javascript"><code class="javascript  language-javascript"><span class="token keyword">function</span> <span class="token function">asyncHandler</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The unit test tells the rest of the story:</p>
<pre class=" language-javascript"><code class="javascript  language-javascript"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'does not catch exceptions with errors'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> fn <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">'type error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">failedPromise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">target</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>should<span class="token punctuation">.</span>be<span class="token punctuation">.</span><span class="token function">rejectedWith</span><span class="token punctuation">(</span>TypeError<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">failedPromise</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>I had to wrap the handler around a promise to verify the exception. Note that an unhandled exception occurs, although I have the code block around a nice <code class=" language-javascript"><span class="token keyword">try</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">catch</span></code>. Yes, <code class=" language-javascript"><span class="token keyword">try</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">catch</span></code> statements only work within a single executing context. By the time an exception gets thrown, the interpreter has moved away from the try-catch. This same behavior occurs with Ajax calls too. So, there are two options. One alternative is to catch exceptions inside the asynchronous callback:</p>
<pre class=" language-javascript"><code class="javascript  language-javascript"><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
       <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// Handle this async error</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>This approach will work, but it leaves much room for improvement. First of all, <code class=" language-javascript"><span class="token keyword">try</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">catch</span></code> blocks get tangled up all over the place. In fact, the 1970s programming called and they want their code back. Plus, the V8 engine discourages the use of <a href="https://github.com/nodejs/node-v0.x-archive/wiki/Best-practices-and-gotchas-with-v8">try…catch blocks inside functions</a> (V8 is the JavaScript engine used in the Chrome browser and Node). Their recommendation is to write those blocks at the top of the call stack. </p>
<p>So, where does this lead us? There is a reason I said global error handlers operate within any executing context. If you add an error handler to the window object, that’s it, you are done! Isn’t it nice that the decision to stay DRY and SOLID is paying off? A global error handler will keep your code nice and clean. </p>
<p>Below is what this exception handler reports on the server. Note that if you’re following along with the demo code, the output you see may be slightly different depending on which browser you’re using.</p>
<p><img src="http://dab1nmslvvntp.cloudfront.net/wp-content/uploads/2016/02/1455237145proper_error_handling_javascript_3.jpg" alt="Async error report on the server"></p>
<p>This handler even tells me that the error is coming from asynchronous code. It tells me it is coming from a <code class=" language-javascript"><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code> handler. Too cool!</p>
<h2 id="conclusion">Conclusion</h2>
<p>In the world of error handling there are at least two approaches. One is the fail-silent approach where you ignore errors in the code. The other is the fail-fast and unwind approach where errors stop the world and rewind. I think it is clear which of the two I am in favor of and why. My take: don’t hide problems. No one will shame you for accidents that may occur in the program. It is acceptable to stop, rewind and give users another try. In a world that is far from perfect, it is important to allow for a second chance. Errors are inevitable, it’s what you do about them that counts. </p>
  