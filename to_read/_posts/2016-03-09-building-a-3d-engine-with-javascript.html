---
title: "Building a 3D Engine with JavaScript"
description: "Learn how to create a simple 3D graphics for the web without WebGL. Jérémy Heleine teaches you how to build your own 3D engine from scratch with JavaScript."
link: "http://www.sitepoint.com/building-3d-engine-javascript/"
saved: "2016-03-09 12:27:56"
---

    <p><em>This article was peer reviewed by <a href="https://twitter.com/TimSeverien">Tim Severien</a> and <a href="http://www.sitepoint.com/author/scodrington/">Simon Codrington</a>. Thanks to all of SitePoint’s peer reviewers for making SitePoint content the best it can be!</em></p>
<p>Displaying images and other flat shapes in web pages is pretty easy. However, when it comes to displaying 3D shapes things become less easy, as 3D geometry is more complex than 2D geometry. To do that, you can use dedicated technologies and libraries, like <a href="https://en.wikipedia.org/wiki/WebGL">WebGL</a> and <a href="http://threejs.org/">Three.js</a> for example.</p>
<div class="ArticleBox u-inline"><h3 class="ArticleBox_header t-bg">
                    <span class="ArticleBox_icon fa fa-pencil"></span> More from this author
                 </h3><div class="ArticleBox_content"><ul class="ArticleBox_list t-list"><li><a href="http://www.sitepoint.com/wordpress-tags-explained/?utm_source=sitepoint&amp;utm_medium=relatedinline&amp;utm_term=javascript&amp;utm_campaign=relatedauthor">WordPress Tags Explained</a></li><li><a href="http://www.sitepoint.com/how-to-write-a-syntax-highlighting-package-for-atom/?utm_source=sitepoint&amp;utm_medium=relatedinline&amp;utm_term=javascript&amp;utm_campaign=relatedauthor">How To Develop a Package for GitHub's Atom Code Editor</a></li></ul></div></div>
<p>However, these technologies are not necessary if you just want to display some basic shapes, like a cube. Moreover, they won’t help you to understand how they work, and how we can display 3D shapes on a flat screen.</p>
<p>The aim of this tutorial is to explain how we can build a simple 3D engine for the web, without WebGL. We will first see how we can store 3D shapes. Then, we will see how to display these shapes, in two different views.</p>
<h2 id="storingandtransforming3dshapes">Storing and Transforming 3D Shapes</h2>
<h3 id="allshapesarepolyhedrons">All Shapes Are Polyhedrons</h3>
<p>The virtual world differs from the real one in one major way: nothing is continuous, and everything is discrete. For example, you can’t display a perfect circle on a screen. You can approach it by drawing a regular polygon with a lot of edges: the more edges you have, the more “perfect” is your circle.</p>
<p>In 3D, it’s the same thing and every shape must be approached with the 3D equivalent of a polygon: a <a href="https://en.wikipedia.org/wiki/Polyhedron">polyhedron</a> (a 3D shape in which we only find flat faces ant not curved sides as in a sphere). It’s not surprising when we talk about a shape that is already a polyhedron, like a cube, but it’s something to keep in mind when we want to display other shapes, like a sphere.</p>
<p><img src="http://dab1nmslvvntp.cloudfront.net/wp-content/uploads/2016/02/1454758145sphere.png" alt="Sphere"></p>
<h3 id="storingapolyhedron">Storing a Polyhedron</h3>
<p>To guess how to store a polyhedron, we have to remember how such a thing can be identified in maths. You surely already did some basic geometry during your school years. To identify a square, for example, you call it <code class=" language-undefined">ABCD</code>, with <code class=" language-undefined">A</code>, <code class=" language-undefined">B</code>, <code class=" language-undefined">C</code> and <code class=" language-undefined">D</code> referring to vertices that make up each corner of the square.</p>
<p>For our 3D engine, it will be the same. We will begin by storing each vertex of our shape. Then, this shape will list its faces, and each face will list its vertices.</p>
<p>To represent a vertex, we need the right structure. Here we create a class to store the coordinates of the vertex.</p>
<pre class=" language-javascript"><code class="javascript  language-javascript"><span class="token keyword">var</span> Vertex <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>z <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>Now a vertex can be created like any other object:</p>
<pre class=" language-javascript"><code class="javascript  language-javascript"><span class="token keyword">var</span> A <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vertex</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Next, we create a class representing our polyhedron. Let’s take a cube as an example. The definition of the class is below, with the explanation right after.</p>
<pre class=" language-javascript"><code class="javascript  language-javascript"><span class="token keyword">var</span> Cube <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>center<span class="token punctuation">,</span> size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// Generate the vertices</span>
    <span class="token keyword">var</span> d <span class="token operator">=</span> size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>vertices <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">Vertex</span><span class="token punctuation">(</span>center<span class="token punctuation">.</span>x <span class="token operator">-</span> d<span class="token punctuation">,</span> center<span class="token punctuation">.</span>y <span class="token operator">-</span> d<span class="token punctuation">,</span> center<span class="token punctuation">.</span>z <span class="token operator">+</span> d<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">Vertex</span><span class="token punctuation">(</span>center<span class="token punctuation">.</span>x <span class="token operator">-</span> d<span class="token punctuation">,</span> center<span class="token punctuation">.</span>y <span class="token operator">-</span> d<span class="token punctuation">,</span> center<span class="token punctuation">.</span>z <span class="token operator">-</span> d<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">Vertex</span><span class="token punctuation">(</span>center<span class="token punctuation">.</span>x <span class="token operator">+</span> d<span class="token punctuation">,</span> center<span class="token punctuation">.</span>y <span class="token operator">-</span> d<span class="token punctuation">,</span> center<span class="token punctuation">.</span>z <span class="token operator">-</span> d<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">Vertex</span><span class="token punctuation">(</span>center<span class="token punctuation">.</span>x <span class="token operator">+</span> d<span class="token punctuation">,</span> center<span class="token punctuation">.</span>y <span class="token operator">-</span> d<span class="token punctuation">,</span> center<span class="token punctuation">.</span>z <span class="token operator">+</span> d<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">Vertex</span><span class="token punctuation">(</span>center<span class="token punctuation">.</span>x <span class="token operator">+</span> d<span class="token punctuation">,</span> center<span class="token punctuation">.</span>y <span class="token operator">+</span> d<span class="token punctuation">,</span> center<span class="token punctuation">.</span>z <span class="token operator">+</span> d<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">Vertex</span><span class="token punctuation">(</span>center<span class="token punctuation">.</span>x <span class="token operator">+</span> d<span class="token punctuation">,</span> center<span class="token punctuation">.</span>y <span class="token operator">+</span> d<span class="token punctuation">,</span> center<span class="token punctuation">.</span>z <span class="token operator">-</span> d<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">Vertex</span><span class="token punctuation">(</span>center<span class="token punctuation">.</span>x <span class="token operator">-</span> d<span class="token punctuation">,</span> center<span class="token punctuation">.</span>y <span class="token operator">+</span> d<span class="token punctuation">,</span> center<span class="token punctuation">.</span>z <span class="token operator">-</span> d<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">Vertex</span><span class="token punctuation">(</span>center<span class="token punctuation">.</span>x <span class="token operator">-</span> d<span class="token punctuation">,</span> center<span class="token punctuation">.</span>y <span class="token operator">+</span> d<span class="token punctuation">,</span> center<span class="token punctuation">.</span>z <span class="token operator">+</span> d<span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// Generate the faces</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>faces <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>vertices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vertices<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vertices<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vertices<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>vertices<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vertices<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vertices<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vertices<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>vertices<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vertices<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vertices<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vertices<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>vertices<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vertices<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vertices<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vertices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>vertices<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vertices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vertices<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vertices<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>vertices<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vertices<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vertices<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vertices<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>Using this class, we can create a virtual cube by indicating its center and the length of its edges.</p>
<pre class=" language-javascript"><code class="javascript  language-javascript"><span class="token keyword">var</span> cube <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cube</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Vertex</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>The constructor of the <code class=" language-undefined">Cube</code> class begins by generating the vertices of the cube, calculated from the position of the indicated center. A schema will be clearer, so see below the positions of the eight vertices we generate:</p>
<p><img src="http://dab1nmslvvntp.cloudfront.net/wp-content/uploads/2016/02/1454758168cube.png" alt="Cube"></p>
<p>Then, we list the faces. Each face is a square, so we need to indicate four vertices for each face. Here I chose to represent a face with an array but, if you needed, you could create a dedicated class for that.</p>
<p>When we create a face, we use four vertices. We don’t need to indicate their position again, as they are stored in the <code class=" language-undefined">this.vertices[i]</code> object. It’s practical, but there is another reason why we did that.</p>
<p>By default, JavaScript tries to use the least amount of memory possible. To achieve that, it doesn’t copy the objects that are passed as functions arguments or even stored into arrays. For our case, it’s perfect behavior.</p>
<p>In fact, each vertex contains three numbers (their coordinates), plus several methods if we need to add them. If, for each face, we store a copy of the vertex, we will use a lot of memory, which is useless. Here, all we have are references: the coordinates (and other methods) are stored once, and only once. As each vertex is used by three different faces, by storing references and not copies, we divide the required memory by three (more or less)!</p>
<h3 id="doweneedtriangles">Do We Need Triangles?</h3>
<p>If you have already played with 3D (with software like Blender for example, or with libraries like WebGL), maybe you have heard that we should use triangles. Here, I’ve chosen to not use triangles.</p>
<p>The reason behind this choice is that this article is an introduction to the topic and we will be displaying basic shapes like cubes. Using triangles to display squares would be more of a complication than anything else in our case.</p>
<p>However, if you plan to build a more complete renderer, then you need to know that, in general, triangles are preferred. There are two main reasons for this:</p>
<ol>
<li>Textures: to display images on faces we need triangles, for some mathematic reasons;</li>
<li>Weird faces: three vertices are always in the same plane. However, you can add a fourth vertex that isn’t in the same plane, and you can create a face joining these four vertices. In such a case, to draw it, we don’t have choice: we must split it into two triangles (just try with a sheet of paper!). By using triangles, you keep the control and you choose where the split occurs (thanks <a href="http://www.sitepoint.com/author/tseverien/">Tim</a> for the reminder!).</li>
</ol>
<h3 id="actingonapolyhedron">Acting on a Polyhedron</h3>
<p>There is another advantage in storing references instead of copies. When we want to modify a polyhedron, using such a system will also divide the needed number of operations by three.</p>
<p>To understand why, let’s recall once again our math class. When you want to translate a square, you don’t really translate it. In fact, you translate the four vertices, and you join the translations.</p>
<p>Here, we will do the same: we won’t touch the faces. We apply the wanted operation on each vertex and we’re done. As faces use references, the coordinates of the faces are automatically updated. For instance, see how we can translate our previously created cube:</p>
<pre class=" language-javascript"><code class="javascript  language-javascript"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cube<span class="token punctuation">.</span>vertices<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>
    cube<span class="token punctuation">.</span>vertices<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
    cube<span class="token punctuation">.</span>vertices<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>z <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="renderinganimage">Rendering an Image</h2>
<p>We know how to store 3D objects and how to act on them. Now it’s time to see how to view them! But, first we need a small  background in the theory, in order to understand what we’re going to do.</p>
<h3 id="projection">Projection</h3>
<p>Currently, we store 3D coordinates. However, a screen can only display 2D coordinates so we need a way to transform our 3D coordinates into 2D ones: that’s what we call a projection in math. The 3D to 2D projection is an abstract operation made by a new object called a virtual camera. This camera takes a 3D object and converts its coordinates into 2D ones, to send them to the renderer which will display them on the screen. We will assume here that our camera is placed at the origin of our 3D space (so its coordinates are <code class=" language-undefined">(0,0,0)</code>).</p>
<p>Since the beginning of this article we’ve talked about coordinates, represented by three numbers: <code class=" language-undefined">x</code>, <code class=" language-undefined">y</code> and <code class=" language-undefined">z</code>. But to define coordinates, we need a basis: is <code class=" language-undefined">z</code> the vertical coordinate? Does it go to the top or to the bottom? There is no universal answer, and no convention, as the fact is that you can choose whatever you want. The only thing you have to keep in mind is that when you act on 3D objects, you have to be consistent, as formulas will change depending on it. In this article, I chose the basis you can see in the schema of the cube above: <code class=" language-undefined">x</code> from left to right, <code class=" language-undefined">y</code> from back to front and <code class=" language-undefined">z</code> from bottom to top.</p>
<p>Now, we know what to do: we have coordinates in the <code class=" language-undefined">(x,y,z)</code> basis and, to display them, we need to convert them into coordinates in the <code class=" language-undefined">(x,z)</code> basis: as it’s a plane, we will be able to display them.</p>
<p>There isn’t only one projection. Worse, there exists an infinite number of different projections! In this article we will see two different types of projection, which are in practice the most used ones.</p>
<h3 id="howtorenderourscene">How to Render Our Scene</h3>
<p>Before projecting our objects, let’s write the function that will display them. This function accepts as parameters an array listing the objects to render, the context of the canvas that must be used to display the objects, and other details needed to draw the objects at the right place.</p>
<p>The array can contain several objects to render. These objects have to respect one thing: having a public property named <code class=" language-undefined">faces</code> that is an array listing all the faces of the object (like our previously created cube). These faces can be anything (square, triangle, or even a dodecagon, if you want): they just need to be arrays listing their vertices.</p>
<p>Let’s look at the code for the function, followed by the explanation:</p>
<pre class=" language-javascript"><code class="javascript  language-javascript"><span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span>objects<span class="token punctuation">,</span> ctx<span class="token punctuation">,</span> dx<span class="token punctuation">,</span> dy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// For each object</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> n_obj <span class="token operator">=</span> objects<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n_obj<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// For each face</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> n_faces <span class="token operator">=</span> objects<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>faces<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> n_faces<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// Current face</span>
            <span class="token keyword">var</span> face <span class="token operator">=</span> objects<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>faces<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>

            <span class="token comment" spellcheck="true">// Draw the first vertex</span>
            <span class="token keyword">var</span> P <span class="token operator">=</span> <span class="token function">project</span><span class="token punctuation">(</span>face<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ctx<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>P<span class="token punctuation">.</span>x <span class="token operator">+</span> dx<span class="token punctuation">,</span> <span class="token operator">-</span>P<span class="token punctuation">.</span>y <span class="token operator">+</span> dy<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment" spellcheck="true">// Draw the other vertices</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> k <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> n_vertices <span class="token operator">=</span> face<span class="token punctuation">.</span>length<span class="token punctuation">;</span> k <span class="token operator">&lt;</span> n_vertices<span class="token punctuation">;</span> <span class="token operator">++</span>k<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                P <span class="token operator">=</span> <span class="token function">project</span><span class="token punctuation">(</span>face<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                ctx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>P<span class="token punctuation">.</span>x <span class="token operator">+</span> dx<span class="token punctuation">,</span> <span class="token operator">-</span>P<span class="token punctuation">.</span>y <span class="token operator">+</span> dy<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment" spellcheck="true">// Close the path and draw the face</span>
            ctx<span class="token punctuation">.</span><span class="token function">closePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ctx<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ctx<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>This function deserves some explanation. More precisely we need to explain what is this <code class=" language-undefined">project()</code> function, and what are these <code class=" language-undefined">dx</code> and <code class=" language-undefined">dy</code> arguments. The rest is basically nothing other than listing the objects, then drawing each face.</p>
<p>As its name suggests, the <code class=" language-undefined">project()</code> function is here to convert 3D coordinates into 2D ones. It accepts a vertex in 3D space and returns a vertex in the 2D plane that we could define as below.</p>
<pre class=" language-javascript"><code class="javascript  language-javascript"><span class="token keyword">var</span> Vertex2D <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>Instead of naming the coordinates <code class=" language-undefined">x</code> and <code class=" language-undefined">z</code> I chose here to rename the <code class=" language-undefined">z</code> coordinate into <code class=" language-undefined">y</code>, to maintain the classical convention we often find in 2D geometry, but you can keep <code class=" language-undefined">z</code> if you prefer.</p>
<p>The exact content of <code class=" language-undefined">project()</code> is what we will see in the next section: it depends on the type of projection you choose. But whatever this type is, the <code class=" language-undefined">render()</code> function can be kept as it is now.</p>
<p>Once we have coordinates on the plane, we can display them on the canvas, and that’s what we do… with a little trick: we don’t really draw the actual coordinates returned by the <code class=" language-undefined">project()</code> function.</p>
<p>In fact, the <code class=" language-undefined">project()</code> function returns coordinates on a virtual 2D plane, but with the same origin than the one we defined for our 3D space. However, we want the origin to be at the center of our canvas, that’s why we translate the coordinates: the vertex <code class=" language-undefined">(0,0)</code> is not at the center of the canvas, but <code class=" language-undefined">(0 + dx,0 + dy)</code> is, if we choose <code class=" language-undefined">dx</code> and <code class=" language-undefined">dy</code> wisely. As we want <code class=" language-undefined">(dx,dy)</code> to be at the center of the canvas, we don’t have really the choice and we define <code class=" language-undefined">dx = canvas.width / 2</code> and <code class=" language-undefined">dy = canvas.height / 2</code>.</p>
<p>Finally, the last detail: why are we using <code class=" language-undefined">-y</code> and not <code class=" language-undefined">y</code> directly? The answer is in our choice of basis: the <code class=" language-undefined">z</code> axis is directed to the top. Then, in our scene, a vertice with a positive z-coordinate will move up. However, on the canvas, the <code class=" language-undefined">y</code> axis is directed to the bottom: a vertice with a positive y-coordinate will move down. That’s why we need to define the canvas’ y-coordinate on the canvas as the reverse of the z-coordinate of our scene.</p>
<p>Now that the <code class=" language-undefined">render()</code> function is clear, it’s time to looks at <code class=" language-undefined">project()</code>.</p>
<h3 id="orthographicview">Orthographic View</h3>
<p>Let’s begin with orthographic projection. As it’s the simplest, it’s perfect to understand what we’ll do.</p>
<p>We have three coordinates, and we want only two. What’s the simplest thing to do in such a case? Remove one of the coordinates. And that’s what we do in orthographic view. We will remove the coordinate that represents the depth: the <code class=" language-undefined">y</code> coordinate.</p>
<pre class=" language-javascript"><code class="javascript  language-javascript"><span class="token keyword">function</span> <span class="token function">project</span><span class="token punctuation">(</span>M<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Vertex2D</span><span class="token punctuation">(</span>M<span class="token punctuation">.</span>x<span class="token punctuation">,</span> M<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>You can now test all the code we wrote since the beginning of this article: it works! Congratulations, you just displayed a 3D object on a flat screen!</p>
<p>This function is implemented in the live example below, where you can interact with the cube by rotating it with your mouse.</p>
<div><iframe id="cp_embed_obapXL" src="http://codepen.io/SitePoint/embed/obapXL?height=266&amp;theme-id=6441&amp;slug-hash=obapXL&amp;default-tab=result&amp;user=SitePoint" scrolling="no" frameborder="0" height="266" allowtransparency="true" allowfullscreen="true" name="CodePen Embed" title="CodePen Embed" class="cp_embed_iframe "></iframe></div>
<p></p>
<p>Sometimes, an orthographic view is what we want, as it has the advantage of preserving the parallels. However, it’s not the most natural view: our eyes don’t see like that. That’s why we will see a second projection: the perspective view.</p>
<h3 id="perspectiveview">Perspective View</h3>
<p>The perspective view is a bit more complex than the orthographic one, as we need to do some calculations. However, these calculations are not so complicated and you just need to know one thing: how to use the <a href="https://en.wikipedia.org/wiki/Intercept_theorem">intercept theorem</a>.</p>
<p>To understand why, let’s look at a schema representing the orthographic view. We projected our points on a plane in an orthogonal way.</p>
<p><img src="http://dab1nmslvvntp.cloudfront.net/wp-content/uploads/2016/02/1454758163orthographic-view.png" alt="Orthographic View"></p>
<p>But, in real life, our eyes act more like on the following schema.</p>
<p><img src="http://dab1nmslvvntp.cloudfront.net/wp-content/uploads/2016/02/1454758150perspective-view.png" alt="Perspective View"></p>
<p>Basically we have then two steps:</p>
<ol>
<li>We join the original vertex and the origin of the camera;</li>
<li>The projection is the intersection between this line and the plane.</li>
</ol>
<p>Contrary to the orthographic view, the exact location of the plane here is important: if you place the plane far from the camera, you won’t obtain the same effect than if you place it close to it. Here we place it at the distance <code class=" language-undefined">d</code> from the camera.</p>
<p>Starting from a vertex <code class=" language-undefined">M(x,y,z)</code> in the 3D space, we want to calculate the coordinates <code class=" language-undefined">(x',z')</code> of the projection <code class=" language-undefined">M'</code> on the plane.</p>
<p><img src="http://dab1nmslvvntp.cloudfront.net/wp-content/uploads/2016/02/1454758154perspective-projection.png" alt="Perspective Projection"></p>
<p>To guess how we will calculate these coordinates, let’s take another point of view and see the same schema as above, but seen from the top.</p>
<p><img src="http://dab1nmslvvntp.cloudfront.net/wp-content/uploads/2016/02/1454758159perspective-projection-top.png" alt="Perspective Projection from Top"></p>
<p>We can recognize a configuration used in the intercept theorem. On the schema above, we know some values: <code class=" language-undefined">x</code>, <code class=" language-undefined">y</code> and <code class=" language-undefined">d</code>, among others. We want to calculate <code class=" language-undefined">x'</code> so we apply the intercept theorem and obtain this equation: <code class=" language-undefined">x' = d / y * x</code>.</p>
<p>Now, if you look at the same scene from a side, you get a similar schema, allowing you to obtain the value of <code class=" language-undefined">z'</code> thanks to <code class=" language-undefined">z</code>, <code class=" language-undefined">y</code> and <code class=" language-undefined">d</code>: <code class=" language-undefined">z' = d / y * z</code>.</p>
<p>We can now write the <code class=" language-undefined">project()</code> function using the perspective view:</p>
<pre class=" language-javascript"><code class="javascript  language-javascript"><span class="token keyword">function</span> <span class="token function">project</span><span class="token punctuation">(</span>M<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// Distance between the camera and the plane</span>
    <span class="token keyword">var</span> d <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> r <span class="token operator">=</span> d <span class="token operator">/</span> M<span class="token punctuation">.</span>y<span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Vertex2D</span><span class="token punctuation">(</span>r <span class="token operator">*</span> M<span class="token punctuation">.</span>x<span class="token punctuation">,</span> r <span class="token operator">*</span> M<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>This function can be tested in the live example below. Once again, you can interact with the cube.</p>
<div><iframe id="cp_embed_VeEyvm" src="http://codepen.io/SitePoint/embed/VeEyvm?height=477&amp;theme-id=6441&amp;slug-hash=VeEyvm&amp;default-tab=result&amp;user=SitePoint" scrolling="no" frameborder="0" height="477" allowtransparency="true" allowfullscreen="true" name="CodePen Embed" title="CodePen Embed" class="cp_embed_iframe "></iframe></div>
<p><iframe src="http://tpc.googlesyndication.com/safeframe/1-0-2/html/container.html" width="0" height="0"></iframe></p>
<h2 id="closingwords">Closing Words</h2>
<p>Our (very basic) 3D engine is now ready to display any 3D shape we want. There are some things you could do to enhance it. For example, we see every face of our shapes, even the ones at the back. To hide them, you could implement <a href="https://en.wikipedia.org/wiki/Back-face_culling">back-face culling</a>.</p>
<p>Also, we didn’t talk about textures. Here, all our shapes share the same color. You can change that by, for example, adding a <code class=" language-undefined">color</code> property in your objects, to know how to draw them. You can even choose one color per face without changing a lot of things. You can also try to display images on the faces. However, it’s more difficult and detailing how to do such a thing would take a whole article.</p>
<p>Other things can be changed. We placed the camera at the origin of the space, but you can move it (a change of basis will be needed before projecting the vertices). Also, vertices placed behind the camera are here drawn, and that’s not a thing we want. A <a href="https://en.wikipedia.org/wiki/Clipping_path">clipping plane</a> can fix that (easy to understand, less easy to implement).</p>
<p>As you see, the 3D engine we built here is far to be complete, and it’s also my own interpretation. You can add your own touch with other classes: for example, Three.js uses a dedicated class to manage the camera and the projection. Also, we used basic math to store the coordinates, but if you want to create a more complex application and if you need, for instance, to rotate a lot of vertices during a frame, you won’t have a smooth experience. To optimize it, you will need some more complex math: <a href="https://en.wikipedia.org/wiki/Homogeneous_coordinates">homogeneous coordinates</a> (projective geometry) and <a href="https://en.wikipedia.org/wiki/Quaternion">quaternions</a>.</p>
<p>If you have ideas for your own improvements to the engine, or have built something cool based on this code, please let me know in the comments below!</p>
  