---
title: "Rust for Web — Medium"
description: "RESTful API in Rust, impressions"
link: "https://medium.com/@eugeniyoz/restful-api-in-rust-impressions-63250d611d15#.jun12vfkl"
saved: "2016-02-01 14:31:37"
---
<section name="801f" class=" section--body section--first"><div class="section-divider layoutSingleColumn"><hr class="section-divider"></div><div class="section-content"><div class="section-inner u-sizeFullWidth"><figure name="2e01" id="2e01" class="graf--figure graf--layoutFillWidth graf--first"><div class="aspectRatioPlaceholder is-locked"><div class="progressiveMedia js-progressiveMedia graf-image is-canvasLoaded is-imageLoaded" data-image-id="1*Y1k795hm2FUkpfft86gsGQ.png" data-width="3000" data-height="600" data-is-featured="true" data-scroll="native"><img src="https://cdn-images-2.medium.com/freeze/max/30/1*Y1k795hm2FUkpfft86gsGQ.png?q=20" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="15"></canvas><img class="progressiveMedia-image js-progressiveMedia-image" data-src="https://cdn-images-2.medium.com/max/2000/1*Y1k795hm2FUkpfft86gsGQ.png" src="https://cdn-images-2.medium.com/max/2000/1*Y1k795hm2FUkpfft86gsGQ.png"><noscript class="js-progressiveMedia-inner">&lt;img class="progressiveMedia-noscript js-progressiveMedia-inner" src="https://cdn-images-2.medium.com/max/2000/1*Y1k795hm2FUkpfft86gsGQ.png"&gt;</noscript></div></div></figure></div><div class="section-inner layoutSingleColumn"><h3 name="e467" id="e467" class="graf--h3 graf-after--figure">Rust for the Web</h3><h4 name="02fd" id="02fd" class="graf--h4 graf-after--h3">RESTful API in Rust, impressions</h4><p name="71da" id="71da" class="graf--p graf-after--h4">Almost 3 months ago my employer accepted my idea to write our API in Rust</p><figure name="f172" id="f172" class="graf--figure graf--iframe graf-after--p"><div class="iframeContainer"><iframe width="700" height="250" src="https://medium.com/media/5d1a118a7d57bc39279934240238c372?maxWidth=700" data-media-id="5d1a118a7d57bc39279934240238c372" frameborder="0"></iframe></div></figure><p name="3448" id="3448" class="graf--p graf-after--figure">First “dev” version of new API was deployed after 20 days — I was not only writing new API, but also learning new programming language. First steps were slow, initial learning curve is steep enough. A lot, a lot of times I was near to change my decision and ask my employer to switch back to PHP, but each time Rust community was kind, friendly and smart enough to give me advice how to solve my issue. I’m endlessly thankful to them.</p><p name="e4f0" id="e4f0" class="graf--p graf-after--p">Right now 2 of our web apps (Angular 2 SPA) are published and working in “production” mode, using this REST API. These apps are very important for business they serve.</p><h3 name="8a21" id="8a21" class="graf--h3 graf-after--p">Rust overview</h3><p name="f8be" id="f8be" class="graf--p graf-after--h3">Before Rust I had experience with PHP (10 years) and JavaScript (5 years). It’s my background and my points of view are based on it. If you are not interested in long description of my impressions from Rust — just scroll to “Practice” part&nbsp;:)</p><h4 name="25f1" id="25f1" class="graf--h4 graf-after--p"><strong class="markup--strong markup--h4-strong">Ownership system</strong></h4><p name="1ddd" id="1ddd" class="graf--p graf-after--h4">This thing was not really difficult to understand. Of course, few first weeks I experienced a lot of errors from compiler about borrowing and lifetimes, but it’s because in other languages we don’t have such strict checks, and now I’m sure it’s a “must have” thing.</p><p name="f16d" id="f16d" class="graf--p graf-after--p">Here is how I understand Rust ownership system in my brains: you can pass variable to some context either by value or by reference. In first case be ready to say “good bye, I will never use you in this context”. Really, you gave whole value — nothing left. Make a copy (clone) if you need same value in following lines. In second case (reference) just be sure that source context will live longer than target context. Otherwise, when source context will try to die, we will have to kill value with context it belongs to, and target context will use reference to dead value — compiler will not allow us to be so cruel. Same rules for returning values from function — it’s also sending them from one context to another.</p><p name="213d" id="213d" class="graf--p graf-after--p">There are some more <a href="https://doc.rust-lang.org/book/ownership.html" data-href="https://doc.rust-lang.org/book/ownership.html" class="markup--anchor markup--p-anchor" rel="nofollow">details</a>, but these 2 rules helped me to almost forget about compiler errors, related to ownership/borrowing/lifetimes.</p><p name="f265" id="f265" class="graf--p graf-after--p">This ownership system removes a lot, <strong class="markup--strong markup--p-strong">a lot</strong> of bugs, especially dangerous things like race conditions, when code in other language will happily write and damage your data and you will not see any warnings or failures, sometimes you will not even notice bug itself (because race conditions can be very tricky to catch). It’s very important for asynchronous algorithms also, when multiple execution flows can mutate one resource (variable, object, collection). Rust takes care of it, and gives you handy tools to work with it.</p><h4 name="28e1" id="28e1" class="graf--h4 graf-after--p">Compiler</h4><p name="60b5" id="60b5" class="graf--p graf-after--h4">Compiler is smart and gives very descriptive error messages, instead of just “no, I won’t compile it”. Sometimes you’ll even find generated examples of code to fix your errors!</p><p name="4991" id="4991" class="graf--p graf-after--p">Now I feel compiler is my friend. Emotions of first week were “stop being so pedantic, I know better it will work”. One month later I was running <strong class="markup--strong markup--p-strong">cargo build</strong> with words “ok, now show me where I’m wrong”. Then was period of “damned strings”. Now I rarely see errors and almost all of them are related to things I forgot to change during refactoring — because I can refactor code without fear and I know compiler will show me where I forgot something. And I use this feature.</p><h4 name="61eb" id="61eb" class="graf--h4 graf-after--p">Tools, ecosystem</h4><p name="296d" id="296d" class="graf--p graf-after--h4">Most bright star here is <a href="http://doc.crates.io/guide.html" data-href="http://doc.crates.io/guide.html" class="markup--anchor markup--p-anchor" rel="nofollow">Cargo</a>. Cargo is awesome, I love it so much! It can help you compile your code, run tests, generate documentation, bring you crates (libraries), you will not worry about different crates versions on different machines, using same repository. I wish we had same tool in other languages also.</p><p name="32da" id="32da" class="graf--p graf-after--p">Almost all things I tried for my web-dev needs, are covered by crates. Some of them are not as mature as I wish, but most of them are pretty usable, well documented, and with strict compiler you can be sure — if it compiled, it will work. Frameworks Iron and Nickel are pretty active in development and mature enough.</p><p name="e8f6" id="e8f6" class="graf--p graf-after--p">I’m glad to see when crates have no “unsafe” code and when they are trying to avoid usage of “panic”. I think we need some kind of badges to promote such crates.</p><p name="d4b7" id="d4b7" class="graf--p graf-after--p">IDE support is not perfect yet, but enough for productive work. I use <a href="https://github.com/intellij-rust/intellij-rust" data-href="https://github.com/intellij-rust/intellij-rust" class="markup--anchor markup--p-anchor" rel="nofollow">plugin</a> for IntelliJ IDEA, it works fine and stable enough, I don’t know why they still don’t release it&nbsp;:) Not all kinds of autocompletion works but.. “<em class="markup--em markup--p-em">we use beta because it’s better than nothing</em>”&nbsp;:)</p><p name="e1e8" id="e1e8" class="graf--p graf-after--p">More information about support in IDEs can be found here: <a href="https://www.rust-lang.org/ides.html" data-href="https://www.rust-lang.org/ides.html" class="markup--anchor markup--p-anchor" rel="nofollow">https://www.rust-lang.org/ides.html</a></p><h4 name="3b7c" id="3b7c" class="graf--h4 graf-after--p">Syntax</h4><p name="4e36" id="4e36" class="graf--p graf-after--h4">From my point of view, syntax is not the most strong part of Rust, but it’s the price I’m ready to pay for Rust’s features. Sometimes it’s over-verbose, especially when we talk about errors handling.</p><p name="531d" id="531d" class="graf--p graf-after--p">After some time I get used to new keywords. Initially I linked them with old terms I used to, and later I realized most of new terms are new for a reason, they bring new features into language and they don’t match one-to-one with old terms. Except “<strong class="markup--strong markup--p-strong">panic</strong>”. Ok, I know, it’s arguable thing, stay calm&nbsp;:)</p><p name="10c0" id="10c0" class="graf--p graf-after--p">Also two things could improve Rust: named arguments and arguments with default value, there is an <a href="https://github.com/rust-lang/rfcs/issues/323" data-href="https://github.com/rust-lang/rfcs/issues/323" class="markup--anchor markup--p-anchor" rel="nofollow">issue on github</a> about it.</p><h4 name="a6c0" id="a6c0" class="graf--h4 graf-after--p">Typing discipline</h4><p name="ef43" id="ef43" class="graf--p graf-after--h4">It’s static and strong, with support of generics. After PHP, I needed just few hours to get used to strong typing and love it. I came to Rust mostly because of strong typing, way of returning results (<strong class="markup--strong markup--p-strong">Result</strong>/<strong class="markup--strong markup--p-strong">Some</strong>), awesome package manager and memory safety. Yes, I had to invest some time to learn it, to get used to it, but now, when I read my PHP code, I often wonder “Instance of what class it returns?.. What does mean <em class="markup--em markup--p-em">maybe</em> <em class="markup--em markup--p-em">this one</em>?? How the hell I was able to work with it??”. Really, good things are easy to get used to.</p><h4 name="f316" id="f316" class="graf--h4 graf-after--p">Community</h4><p name="0663" id="0663" class="graf--p graf-after--h4">Absolutely best part of Rust is community. Friendly, civil and smart people, they helped me to solve a lot of my Rust issues and explained new things to me (thank you!). Authors of crates are responsive and ready to help and listen feedback. Rust itself evolving using RFCs, what allows community to make influence to Rust evolution.</p><h4 name="9f34" id="9f34" class="graf--h4 graf-after--p">Documentation</h4><p name="e038" id="e038" class="graf--p graf-after--h4">Rust has builtin mechanism for <a href="https://doc.rust-lang.org/book/documentation.html" data-href="https://doc.rust-lang.org/book/documentation.html" class="markup--anchor markup--p-anchor" rel="nofollow">documentation</a>, and all the creates I tried, have documentation. Often with examples, sometime with detailed explanations.</p><h3 name="de45" id="de45" class="graf--h3 graf-after--p">Practice</h3><h4 name="7dd1" id="7dd1" class="graf--h4 graf-after--h3">Server</h4><p name="3b1d" id="3b1d" class="graf--p graf-after--h4">We use <a href="http://ironframework.io/" data-href="http://ironframework.io/" class="markup--anchor markup--p-anchor" rel="nofollow">Iron</a> framework, <a href="https://crates.io/crates/redis/" data-href="https://crates.io/crates/redis/" class="markup--anchor markup--p-anchor" rel="nofollow">Redis</a> and <a href="https://crates.io/crates/mysql/" data-href="https://crates.io/crates/mysql/" class="markup--anchor markup--p-anchor" rel="nofollow">MySQL</a> databases, and nginx as proxy.</p><p name="607a" id="607a" class="graf--p graf-after--p">nginx config is pretty simple:</p><figure name="a584" id="a584" class="graf--figure graf--iframe graf-after--p"><div class="iframeContainer"><iframe width="700" height="250" src="https://medium.com/media/27ec7f381251d004cbda44681d397d6d?maxWidth=700" data-media-id="27ec7f381251d004cbda44681d397d6d" frameborder="0"></iframe></div></figure><p name="678e" id="678e" class="graf--p graf-after--figure">Most tricky part for me was hashing passwords, solved by Scrypt module of <a href="https://crates.io/crates/rust-crypto/" data-href="https://crates.io/crates/rust-crypto/" class="markup--anchor markup--p-anchor" rel="nofollow">Rust-Crypto</a>.</p><h4 name="e50d" id="e50d" class="graf--h4 graf-after--p">Testing</h4><p name="7635" id="7635" class="graf--p graf-after--h4">For developer, coming from dynamic languages, Rust compiler removes half of reasons for tests — private functions refactoring safety (compiler gives it for free). Second half is a mix of logic errors, public API safety and remote resources communication, such as databases, files and external APIs. Rust has builtin testing features, so you can just do it from start, without additional dependencies.</p><h4 name="4461" id="4461" class="graf--h4 graf-after--p">Stability</h4><p name="1ff4" id="1ff4" class="graf--p graf-after--h4">Keep calm, avoid <strong class="markup--strong markup--p-strong">panic</strong>s, don’t use <strong class="markup--strong markup--p-strong">unwrap</strong> (<strong class="markup--strong markup--p-strong">unwrap_or</strong> is ok) and your server will be very stable. I use <strong class="markup--strong markup--p-strong">println</strong> and redirect output to file, to create primitive logging, later I’m going to use something more smart and reliable.</p><h4 name="2e4e" id="2e4e" class="graf--h4 graf-after--p">Performance</h4><p name="001a" id="001a" class="graf--p graf-after--h4">As often happens in web servers world, the only bottleneck is DB communication - in our API it takes around 98% of every request. I know Rust is a very performant language, near to C++, but I use Rust not because of it. So there will be no table with sensational numbers, sorry. You just know performance is not an issue at all in Rust, and for web is more than enough&nbsp;:)</p><h4 name="77f4" id="77f4" class="graf--h4 graf-after--p">JSON</h4><p name="3887" id="3887" class="graf--p graf-after--h4">Declaration of nested structures is a pain — you can’t declare structure inside structure, so you need to declare separately all kinds of nested structures, and they nested structures, if such exists. With complex structures it takes a lot of code to describe JSON for them. <a href="https://crates.io/crates/serde/" data-href="https://crates.io/crates/serde/" class="markup--anchor markup--p-anchor" rel="nofollow">Serde</a> even has serde_codegen to help solve this issue. For simple structures all is pretty simple, and encoding is simple in both cases.</p><h4 name="54d9" id="54d9" class="graf--h4 graf-after--p">Deployment</h4><p name="6fbd" id="6fbd" class="graf--p graf-after--h4">I use beanstalkapp and this script after files update:</p><figure name="a6e2" id="a6e2" class="graf--figure graf--iframe graf-after--p"><div class="iframeContainer"><iframe width="700" height="250" src="https://medium.com/media/8402fa141535d7fd9a8d158fa419bb7f?maxWidth=700" data-media-id="8402fa141535d7fd9a8d158fa419bb7f" frameborder="0"></iframe></div></figure><p name="dafc" id="dafc" class="graf--p graf-after--figure">This way you can just print nohup.out to read error messages.</p><h3 name="caa6" id="caa6" class="graf--h3 graf-after--p">Pros &amp; Cons of web server in Rust</h3><h4 name="8d88" id="8d88" class="graf--h4 graf-after--h3">Pros:</h4><ul class="postList"><li name="eda4" id="eda4" class="graf--li graf-after--h4">Compilation step removes a lot of bugs so you save a lot of time, because debugging is much more expensive than writing code;</li><li name="250a" id="250a" class="graf--li graf-after--li">Community will help if you struggle;</li><li name="437b" id="437b" class="graf--li graf-after--li">Main tools are mature enough;</li><li name="a833" id="a833" class="graf--li graf-after--li">Memory safety is a big thing for long-running servers;</li><li name="0c4e" id="0c4e" class="graf--li graf-after--li">thread::spawn is a very handy thing, and safe in Rust.</li></ul><h4 name="faad" id="faad" class="graf--h4 graf-after--li">Cons:</h4><ul class="postList"><li name="b3c3" id="b3c3" class="graf--li graf-after--h4">Learning curve is steep. Don’t give up, ask community when needed.</li></ul><p name="5ee3" id="5ee3" class="graf--p graf-after--li graf--last">Some very simple things take more time to implement in strongly typed language, than in dynamically typed. For example: simple database edits and changing of response JSON structure. But it’s not a big thing as I worried initially — in most cases benefit of shorter debug period eliminates this difference.</p></div></div></section><section name="da94" class=" section--body"><div class="section-divider layoutSingleColumn"><hr class="section-divider"></div><div class="section-content"><div class="section-inner layoutSingleColumn"><p name="c7a5" id="c7a5" class="graf--p graf--first">Learning Rust, you will not only learn new APIs but also you will learn new way of thinking, errors handling, returning errors and data control.</p><p name="4516" id="4516" class="graf--p graf-after--p graf--last">Good luck and welcome aboard!&nbsp;:)</p></div></div></section><section name="6350" class=" section--body section--last"><div class="section-divider layoutSingleColumn"><hr class="section-divider"></div><div class="section-content"><div class="section-inner layoutSingleColumn"><h4 name="b7b9" id="b7b9" class="graf--h4 graf--first">Update 1:</h4><p name="8999" id="8999" class="graf--p graf-after--h4">Removed rant about Result/Some when single branch needed, thanks for <a href="https://news.ycombinator.com/item?id=11006805" data-href="https://news.ycombinator.com/item?id=11006805" class="markup--anchor markup--p-anchor" rel="nofollow">this comment</a>.</p><h4 name="b42a" id="b42a" class="graf--h4 graf-after--p">Update 2:</h4><p name="5eb9" id="5eb9" class="graf--p graf-after--h4">Edited information about Intellij IDEA plugin, after update from authors:</p><blockquote name="3d65" id="3d65" class="graf--blockquote graf-after--p graf--last">Now it should work everywhere in a single crate. You’ll need to import project instead of just opening the project folder though, and you’ll also need a very recent nightly cargo for this to work. As a bonus, import will enable Go To Symbol (Ctrl+Shift+Alt+N) for dependencies.</blockquote></div></div></section>