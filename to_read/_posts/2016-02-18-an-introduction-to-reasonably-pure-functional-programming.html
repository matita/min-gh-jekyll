---
title: "An Introduction to Reasonably Pure Functional Programming"
description: "Mark Brown shows how to to write simpler programs with fewer bugs by using techniques from functional programming in JavaScript"
link: "http://www.sitepoint.com/an-introduction-to-reasonably-pure-functional-programming/"
saved: "2016-02-18 14:11:20"
---

    <p><em>This article was peer reviewed by <a href="https://github.com/pvgr">Panayiotis «pvgr» Velisarakos</a>, <a href="http://www.sitepoint.com/author/jthomas/">Jezen Thomas</a> and <a href="http://www.sitepoint.com/author/frappl/">Florian Rappl</a>. Thanks to all of SitePoint’s peer reviewers for making SitePoint content the best it can be!</em></p>
<p>When learning to program you’re first introduced to procedural programming; this is where you control a machine by feeding it a sequential list of commands.  After you have an understanding of a few language fundamentals like variables, assignment, functions and objects you can cobble together a program that achieves what you set out for it do – and you feel like an absolute wizard.</p>
<div class="ArticleBox u-inline"><h3 class="ArticleBox_header t-bg">
                    <span class="ArticleBox_icon fa fa-pencil"></span> More from this author
                 </h3><div class="ArticleBox_content"><ul class="ArticleBox_list t-list"><li><a href="http://www.sitepoint.com/react-for-angular-developers/?utm_source=sitepoint&amp;utm_medium=relatedinline&amp;utm_term=javascript&amp;utm_campaign=relatedauthor">React for Angular Developers</a></li><li><a href="http://www.sitepoint.com/react-has-won-the-client-side-war/?utm_source=sitepoint&amp;utm_medium=relatedinline&amp;utm_term=javascript&amp;utm_campaign=relatedauthor">Forget Angular &amp; Ember, React Has Already Won the Client-Side War</a></li></ul></div></div>
<p>The process of becoming a <em>better</em> programmer is all about gaining a greater ability to control the programs you write and finding the simplest solution that’s both <em>correct</em> and the <em>most readable</em>.  As you become a better programmer you’ll write smaller functions, achieve better re-use of your code, write tests for your code and you’ll gain confidence that the programs you write will continue to do as you intend.  No one enjoys finding and fixing bugs in code, so becoming a better programmer is also about avoiding certain things that are error-prone.  Learning what to avoid comes through experience or heeding the advice of those more experienced, like Douglas Crockford famously explains in <a href="https://vimeo.com/8691412">JavaScript: The Good Parts</a>.</p>
<p>Functional programming gives us ways to lower the complexity of our programs by reducing them into their simplest forms: functions that behave like pure mathematical functions.  Learning the principles of functional programming is a great addition to your skill set and will help you write simpler programs with fewer bugs.</p>
<p>The key concepts of functional programming are pure functions, immutable values, composition and taming side-effects.</p>
<h2 id="purefunctions">Pure Functions</h2>
<blockquote>
<p>A pure function is a function that, given the same input, will always return the same output and does not have any observable side effect.</p>
</blockquote>
<pre class=" language-javascript"><code class="javascript  language-javascript"><span class="token comment" spellcheck="true">// pure</span>
<span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>This function is <em>pure</em>. It doesn’t depend on or change any state outside of the function and it will <em>always</em> return the same output value for the same input.</p>
<pre class=" language-javascript"><code class="javascript  language-javascript"><span class="token comment" spellcheck="true">// impure</span>
<span class="token keyword">var</span> minimum <span class="token operator">=</span> <span class="token number">21</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> checkAge <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> age <span class="token operator">&gt;=</span> minimum<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// if minimum is changed we're cactus</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>This function is <em>impure</em> as it relies on external mutable state outside of the function.</p>
<p>If we move this variable inside of the function it becomes pure and we can be certain that our function will correctly check our age <em>every time</em>.</p>
<pre class=" language-javascript"><code class="javascript  language-javascript"><span class="token comment" spellcheck="true">// pure</span>
<span class="token keyword">var</span> checkAge <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> minimum <span class="token operator">=</span> <span class="token number">21</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> age <span class="token operator">&gt;=</span> minimum<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>Pure functions have no <em>side-effects</em>. Here are a few important ones to keep in mind:</p>
<ul>
<li>Accessing system state outside of the function</li>
<li>Mutating objects passed as arguments</li>
<li>Making a HTTP call</li>
<li>Obtaining user input</li>
<li>Querying the DOM</li>
</ul>
<h3 id="controlledmutation">Controlled Mutation</h3>
<p>You need to be aware of <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/prototype#Mutator_methods">Mutator methods on Arrays and Objects</a> which change the underling objects, an example of this is the difference between Array’s <code class=" language-javascript">splice</code> and <code class=" language-javascript">slice</code> methods.</p>
<pre class=" language-javascript"><code class="javascript  language-javascript"><span class="token comment" spellcheck="true">// impure, splice mutates the array</span>
<span class="token keyword">var</span> firstThree <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> arr<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// arr may never be the same again</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// pure, slice returns a new array</span>
<span class="token keyword">var</span> firstThree <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> arr<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>If we avoid mutating methods on objects passed to our functions our program becomes easier to reason about, we can reasonably expect our functions not to be switching things out from under us.</p>
<pre class=" language-javascript"><code class="javascript  language-javascript"><span class="token keyword">let</span> items <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">,</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> newItems <span class="token operator">=</span> <span class="token function">pure</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// I expect items to be ['a','b','c']</span>
</code></pre>
<h2 id="benefitsofpurefunctions">Benefits of Pure Functions</h2>
<p>Pure functions have a few benefits over their impure counterparts:</p>
<ul>
<li>More easily <strong>testable</strong> as their sole responsibility is to map input -&gt; output</li>
<li>Results are <strong>cacheable</strong> as the same input always yields the same output</li>
<li><strong>Self documenting</strong> as the function’s dependencies are explicit</li>
<li>Easier to work with as you don’t need to worry about side-effects</li>
</ul>
<p>Because the results of pure functions are cacheable we can <a href="http://underscorejs.org/docs/underscore.html#section-79">memoize</a> them so expensive operations are only performed the first time the functions are called.  For example, memoizing the results of searching a large index would yield big performance improvements on re-runs.</p>
<h2 id="unreasonablypurefunctionalprogramming">Unreasonably Pure Functional Programming</h2>
<p>Reducing our programs down to pure functions can drastically reduce the complexity of our programs. However, our functional programs can also end up requiring Rain Man’s assistance to comprehend if we push functional abstraction too far.</p>
<pre class=" language-javascript"><code class="javascript  language-javascript"><span class="token keyword">import</span> _ <span class="token keyword">from</span> <span class="token string">'ramda'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> $ <span class="token keyword">from</span> <span class="token string">'jquery'</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> Impure <span class="token operator">=</span> <span class="token punctuation">{</span>
  getJSON<span class="token punctuation">:</span> _<span class="token punctuation">.</span><span class="token function">curry</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>callback<span class="token punctuation">,</span> url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    $<span class="token punctuation">.</span><span class="token function">getJSON</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

  setHtml<span class="token punctuation">:</span> _<span class="token punctuation">.</span><span class="token function">curry</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>sel<span class="token punctuation">,</span> html<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">$</span><span class="token punctuation">(</span>sel<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> img <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'&lt;img /&gt;'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> src<span class="token punctuation">:</span> url <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">'http://api.flickr.com/services/feeds/photos_public.gne?tags='</span> <span class="token operator">+</span>
    t <span class="token operator">+</span> <span class="token string">'&amp;format=json&amp;jsoncallback=?'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> mediaUrl <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">compose</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">'m'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> _<span class="token punctuation">.</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">'media'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> mediaToImg <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">compose</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> mediaUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> images <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">compose</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>mediaToImg<span class="token punctuation">)</span><span class="token punctuation">,</span> _<span class="token punctuation">.</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">'items'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> renderImages <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">compose</span><span class="token punctuation">(</span>Impure<span class="token punctuation">.</span><span class="token function">setHtml</span><span class="token punctuation">(</span><span class="token string">"body"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> images<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> app <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">compose</span><span class="token punctuation">(</span>Impure<span class="token punctuation">.</span><span class="token function">getJSON</span><span class="token punctuation">(</span>renderImages<span class="token punctuation">)</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">app</span><span class="token punctuation">(</span><span class="token string">"cats"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Take a minute to digest the code above.</p>
<p>Unless you have a background in functional programming these abstractions (curry, excessive use of compose and prop) are really difficult to follow, as is the flow of execution.  The code below is easier to understand and to modify, it also much more clearly describes the program than the purely functional approach above and it’s less code.</p>
<ul>
<li>The <code class=" language-javascript">app</code> function takes a string of tags</li>
<li>fetches JSON from <a href="https://www.flickr.com/">Flickr</a></li>
<li>pulls the URLs out the response</li>
<li>builds an array of <code class=" language-javascript"><span class="token operator">&lt;</span>img<span class="token operator">&gt;</span></code> nodes</li>
<li>inserts them into the document</li>
</ul>
<pre class=" language-javascript"><code class="javascript  language-javascript"><span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token punctuation">(</span>tags<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token template-string"><span class="token string">`http://api.flickr.com/services/feeds/photos_public.gne?tags=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>tags<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;format=json&amp;jsoncallback=?`</span></span>
  $<span class="token punctuation">.</span><span class="token function">getJSON</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> urls <span class="token operator">=</span> data<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span> item<span class="token punctuation">.</span>media<span class="token punctuation">.</span>m<span class="token punctuation">)</span>
    <span class="token keyword">let</span> images <span class="token operator">=</span> urls<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'&lt;img /&gt;'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> src<span class="token punctuation">:</span> url <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>

    <span class="token function">$</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>images<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">app</span><span class="token punctuation">(</span><span class="token string">"cats"</span><span class="token punctuation">)</span>
</code></pre>
<p>Or, this alternative API using abstractions like <code class=" language-javascript">fetch</code> and <code class=" language-javascript">Promise</code> helps us clarify the meaning of our asynchronous actions even further.</p>
<pre class=" language-javascript"><code class="javascript  language-javascript"><span class="token keyword">let</span> flickr <span class="token operator">=</span> <span class="token punctuation">(</span>tags<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token template-string"><span class="token string">`http://api.flickr.com/services/feeds/photos_public.gne?tags=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>tags<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;format=json&amp;jsoncallback=?`</span></span>
  <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> urls <span class="token operator">=</span> data<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span> item<span class="token punctuation">.</span>media<span class="token punctuation">.</span>m <span class="token punctuation">)</span>
    <span class="token keyword">let</span> images <span class="token operator">=</span> urls<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'&lt;img /&gt;'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> src<span class="token punctuation">:</span> url <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>

    <span class="token keyword">return</span> images
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">flickr</span><span class="token punctuation">(</span><span class="token string">"cats"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>images<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">$</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>images<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p><strong>Note:</strong> <code class=" language-javascript">fetch</code> and <code class=" language-javascript">Promise</code> are upcoming standards so they require polyfills to use today.</p>
<p>The <code class=" language-javascript">Ajax</code> request and the <code class=" language-javascript">DOM</code> operations are never going to be pure but we could make a pure function out of the rest, mapping the response JSON to an array of images – let’s excuse the dependence on jQuery for now.</p>
<pre class=" language-javascript"><code class="javascript  language-javascript"><span class="token keyword">let</span> responseToImages <span class="token operator">=</span> <span class="token punctuation">(</span>resp<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> urls <span class="token operator">=</span> resp<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span> item<span class="token punctuation">.</span>media<span class="token punctuation">.</span>m <span class="token punctuation">)</span>
  <span class="token keyword">let</span> images <span class="token operator">=</span> urls<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'&lt;img /&gt;'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> src<span class="token punctuation">:</span> url <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> images
<span class="token punctuation">}</span>
</code></pre>
<p>Our function is just doing two things now:</p>
<ul>
<li>mapping response <code class=" language-javascript">data</code> -&gt; <code class=" language-javascript">urls</code></li>
<li>mapping <code class=" language-javascript">urls</code> -&gt; <code class=" language-javascript">images</code></li>
</ul>
<p>The “functional” way to do this is to create separate functions for those two tasks and we can use <code class=" language-javascript">compose</code> to pass the response of one function into the other.</p>
<pre class=" language-javascript"><code class="javascript  language-javascript"><span class="token keyword">let</span> urls <span class="token operator">=</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> data<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span> item<span class="token punctuation">.</span>media<span class="token punctuation">.</span>m<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> images <span class="token operator">=</span> <span class="token punctuation">(</span>urls<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> urls<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'&lt;img /&gt;'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> src<span class="token punctuation">:</span> url <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> responseToImages <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">compose</span><span class="token punctuation">(</span>images<span class="token punctuation">,</span> urls<span class="token punctuation">)</span>
</code></pre>
<blockquote>
<p>compose returns a function that is the composition of a list of functions, each consuming the return value of the function that follows.</p>
</blockquote>
<p>Here’s what <code class=" language-javascript">compose</code> is doing, passing the response of <code class=" language-javascript">urls</code> into our <code class=" language-javascript">images</code> function.</p>
<pre class=" language-javascript"><code class="javascript  language-javascript"><span class="token keyword">let</span> responseToImages <span class="token operator">=</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">images</span><span class="token punctuation">(</span><span class="token function">urls</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p>It helps to read the arguments to compose from right to left to understand the direction of data flow.</p>
<p>By reducing our program down to pure functions it gives us a greater ability to reuse them in the future, they are much simpler to test and they are self documenting.  The downside is that when used excessively (like in the first example) these functional abstractions can make things <em>more complex</em> which is certainly not what we want.  The most important question to ask when refactoring code though is this:</p>
<p><strong>Is the code easier to read and understand?</strong></p>
<h2 id="essentialfunctions">Essential Functions</h2>
<p>Now, I’m not trying to attack functional programming at all. Every developer should make a concerted effort to learn the fundamental functions that let you abstract common patterns in programming into much more concise declarative code, or as Marijn Haverbeke puts it..</p>
<blockquote>
<p>A programmer armed with a repertoire of fundamental functions and, more importantly, the knowledge on how to use them, is much more effective than one who starts from scratch. – <a href="http://eloquentjavascript.net/1st_edition/chapter6.html">Eloquent JavaScript, Marijn Haverbeke</a></p>
</blockquote>
<p>Here is a list of essential functions that every JavaScript developer should learn and master. It’s also a great way to brush up on your JavaScript skills to write each of these functions from scratch.</p>
<p><strong>Arrays</strong></p>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach">forEach</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map">map</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/filter">filter</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce">reduce</a></li>
</ul>
<p><strong>Functions</strong></p>
<ul>
<li><a href="http://underscorejs.org/docs/underscore.html#section-83">debounce</a></li>
<li><a href="http://underscorejs.org/docs/underscore.html#section-86">compose</a></li>
<li><a href="http://underscorejs.org/docs/underscore.html#section-77">partial</a></li>
<li><a href="https://lodash.com/docs#curry">curry</a></li>
</ul>
<h2 id="lessismore">Less Is More</h2>
<p>Let’s look at some practical steps we can take to improve the code below using functional programming concepts.</p>
<pre class=" language-javascript"><code class="javascript  language-javascript"><span class="token keyword">let</span> items <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> upperCaseItems <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> ii <span class="token operator">=</span> items<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> ii<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> item <span class="token operator">=</span> items<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  items <span class="token operator">=</span> arr<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>Reduce functions dependence on shared state</strong></p>
<p>This may sounds obvious and trivial but I still write functions that access and modify a lot of state outside of themselves, this makes them harder to test and more prone to error.</p>
<pre class=" language-javascript"><code class="javascript  language-javascript"><span class="token comment" spellcheck="true">// pure</span>
<span class="token keyword">let</span> upperCaseItems <span class="token operator">=</span> <span class="token punctuation">(</span>items<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> ii <span class="token operator">=</span> items<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> ii<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> item <span class="token operator">=</span> items<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> arr<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>Use more readable language abstractions like <code class=" language-javascript">forEach</code> to iterate</strong></p>
<pre class=" language-javascript"><code class="javascript  language-javascript"><span class="token keyword">let</span> upperCaseItems <span class="token operator">=</span> <span class="token punctuation">(</span>items<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  items<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> arr<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>Use higher level abstractions like <code class=" language-javascript">map</code> to reduce the amount of code</strong></p>
<pre class=" language-javascript"><code class="javascript  language-javascript"><span class="token keyword">let</span> upperCaseItems <span class="token operator">=</span> <span class="token punctuation">(</span>items<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> items<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span> item<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>Reduce functions to their simplest forms</strong></p>
<pre class=" language-javascript"><code class="javascript  language-javascript"><span class="token keyword">let</span> upperCase <span class="token operator">=</span> <span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span> item<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> upperCaseItems <span class="token operator">=</span> <span class="token punctuation">(</span>items<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span> items<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>upperCase<span class="token punctuation">)</span>
</code></pre>
<p><strong>Delete code until it stops working</strong></p>
<p>We don’t need a function at all for such a simple task, the language provides us with sufficient abstractions to write it out verbatim.</p>
<pre class=" language-javascript"><code class="javascript  language-javascript"><span class="token keyword">let</span> items <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> upperCaseItems <span class="token operator">=</span> items<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span> item<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="testing">Testing</h2>
<p>Being able to simply test our programs is a key benefit of pure functions, so in this section we’ll set up a test harness for our Flickr module we were looking at earlier.</p>
<p>Fire up a terminal and have your text editor poised and ready, we’ll use <a href="https://mochajs.org/#getting-started">Mocha</a> as our test runner and <a href="http://babeljs.io/">Babel</a> for compiling our ES6 code.</p>
<pre class=" language-bash"><code class="bash  language-bash"><span class="token function">mkdir</span> <span class="token function">test</span><span class="token operator">-</span>harness
<span class="token function">cd</span> <span class="token function">test</span><span class="token operator">-</span>harness
npm init <span class="token operator">-</span><span class="token function">yes</span>
npm <span class="token function">install</span> mocha babel<span class="token operator">-</span>register babel<span class="token operator">-</span>preset<span class="token operator">-</span>es2015 <span class="token operator">--</span>save<span class="token operator">-</span>dev
<span class="token keyword">echo</span> <span class="token string">'{ "presets": ["es2015"] }'</span> <span class="token operator">&gt;</span> <span class="token punctuation">.</span>babelrc
<span class="token function">mkdir</span> <span class="token function">test</span>
<span class="token function">touch</span> <span class="token function">test</span><span class="token operator">/</span>example<span class="token punctuation">.</span>js
</code></pre>
<p>Mocha has a bunch of handy functions like <code class=" language-javascript">describe</code> and <code class=" language-javascript">it</code> for breaking up our tests and hooks such as <code class=" language-javascript">before</code> and <code class=" language-javascript">after</code> for setup and teardown tasks.  <a href="https://nodejs.org/api/assert.html">assert</a> is a core node package that can perform simple equality tests, <code class=" language-javascript">assert</code> and <code class=" language-javascript">assert<span class="token punctuation">.</span>deepEqual</code> are the most useful functions to be aware of.</p>
<p>Let’s write our first test in <code class=" language-javascript">test<span class="token operator">/</span>example<span class="token punctuation">.</span>js</code></p>
<pre class=" language-javascript"><code class="javascript  language-javascript"><span class="token keyword">import</span> assert <span class="token keyword">from</span> <span class="token string">'assert'</span><span class="token punctuation">;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Math'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'.floor'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'rounds down to the nearest whole number'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> value <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token number">4.24</span><span class="token punctuation">)</span>
      <span class="token function">assert</span><span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>Open up <code class=" language-javascript"><span class="token keyword">package</span><span class="token punctuation">.</span>json</code> and amend the <code class=" language-javascript"><span class="token string">"test"</span></code> script to the following</p>
<pre class=" language-bash"><code class="bash  language-bash">mocha <span class="token operator">--</span>compilers js<span class="token punctuation">:</span>babel<span class="token operator">-</span>register <span class="token operator">--</span>recursive
</code></pre>
<p>Then you should be able run <code class=" language-javascript">npm test</code> from the command line to confirm everything is working as expected.</p>
<pre class=" language-bash"><code class="bash  language-bash">Math
  <span class="token punctuation">.</span>floor
    ✓ rounds down to the nearest whole number

<span class="token number">1</span> passing <span class="token punctuation">(</span>32ms<span class="token punctuation">)</span>
</code></pre>
<p>Boom.</p>
<p><strong>Note:</strong> You can also add a <code class=" language-javascript"><span class="token operator">-</span>w</code> flag at the end of this command if you want mocha to watch for changes and run the tests automatically, they will run considerably faster on re-runs.</p>
<pre class=" language-bash"><code class="bash  language-bash">mocha <span class="token operator">--</span>compilers js<span class="token punctuation">:</span>babel<span class="token operator">-</span>register <span class="token operator">--</span>recursive <span class="token operator">-</span>w
</code></pre>
<h3 id="testingourflickrmodule">Testing Our Flickr Module</h3>
<p>Let’s add our module into <code class=" language-javascript">lib<span class="token operator">/</span>flickr<span class="token punctuation">.</span>js</code></p>
<pre class=" language-javascript"><code class="javascript  language-javascript"><span class="token keyword">import</span> $ <span class="token keyword">from</span> <span class="token string">'jquery'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> compose <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'underscore'</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> urls <span class="token operator">=</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> data<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span> item<span class="token punctuation">.</span>media<span class="token punctuation">.</span>m<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> images <span class="token operator">=</span> <span class="token punctuation">(</span>urls<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> urls<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'&lt;img /&gt;'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> src<span class="token punctuation">:</span> url <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> responseToImages <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>images<span class="token punctuation">,</span> urls<span class="token punctuation">)</span>

<span class="token keyword">let</span> flickr <span class="token operator">=</span> <span class="token punctuation">(</span>tags<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token template-string"><span class="token string">`http://api.flickr.com/services/feeds/photos_public.gne?tags=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>tags<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;format=json&amp;jsoncallback=?`</span></span>
  <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>responseToImages<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  _responseToImages<span class="token punctuation">:</span> responseToImages<span class="token punctuation">,</span>
  flickr<span class="token punctuation">:</span> flickr<span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Our module is exposing two methods: <code class=" language-javascript">flickr</code> to be publicly consumed and a private function <code class=" language-javascript">_responseToImages</code> so that we can test that in isolation.</p>
<p>We have a couple of new dependencies: <code class=" language-javascript">jquery</code>, <code class=" language-javascript">underscore</code> and polyfills for <code class=" language-javascript">fetch</code> and <code class=" language-javascript">Promise</code>.  To test those we can use <code class=" language-javascript">jsdom</code> to polyfill the <code class=" language-javascript">DOM</code> objects <code class=" language-javascript">window</code> and <code class=" language-javascript">document</code> and we can use the <code class=" language-javascript">sinon</code> package for stubbing the fetch api.</p>
<pre class=" language-bash"><code class="bash  language-bash">npm <span class="token function">install</span> jquery underscore whatwg<span class="token operator">-</span>fetch es6<span class="token operator">-</span>promise jsdom sinon <span class="token operator">--</span>save<span class="token operator">-</span>dev
<span class="token function">touch</span> <span class="token function">test</span><span class="token operator">/</span>_setup<span class="token punctuation">.</span>js
</code></pre>
<p>Open up <code class=" language-javascript">test<span class="token operator">/</span>_setup<span class="token punctuation">.</span>js</code> and we’ll configure jsdom with our globals that our module depends on.</p>
<pre class=" language-javascript"><code class="javascript  language-javascript">global<span class="token punctuation">.</span>document <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'jsdom'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">jsdom</span><span class="token punctuation">(</span><span class="token string">'&lt;html&gt;&lt;/html&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
global<span class="token punctuation">.</span>window <span class="token operator">=</span> document<span class="token punctuation">.</span>defaultView<span class="token punctuation">;</span>
global<span class="token punctuation">.</span>$ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'jquery'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
global<span class="token punctuation">.</span>fetch <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'whatwg-fetch'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fetch<span class="token punctuation">;</span>
</code></pre>
<p>Our tests can sit in <code class=" language-javascript">test<span class="token operator">/</span>flickr<span class="token punctuation">.</span>js</code> where we’ll make assertions about our functions output given predefined inputs.  We “stub” or override the global fetch method to intercept and fake the HTTP request so that we can run our tests without hitting the Flickr API directly.</p>
<pre class=" language-javascript"><code class="javascript  language-javascript"><span class="token keyword">import</span> assert <span class="token keyword">from</span> <span class="token string">'assert'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Flickr <span class="token keyword">from</span> <span class="token string">"../lib/flickr"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> sinon <span class="token keyword">from</span> <span class="token string">"sinon"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Promise <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'es6-promise'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Response <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'whatwg-fetch'</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> sampleResponse <span class="token operator">=</span> <span class="token punctuation">{</span>
  items<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    media<span class="token punctuation">:</span> <span class="token punctuation">{</span> m<span class="token punctuation">:</span> <span class="token string">'lolcat.jpg'</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
    media<span class="token punctuation">:</span> <span class="token punctuation">{</span> m<span class="token punctuation">:</span> <span class="token string">'dancing_pug.gif'</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// In a real project we'd shift this test helper into a module</span>
<span class="token keyword">let</span> jsonResponse <span class="token operator">=</span> <span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> json <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> response <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    status<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
    headers<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token string">'Content-type'</span><span class="token punctuation">:</span> <span class="token string">'application/json'</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Flickr'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'._responseToImages'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"maps response JSON to a NodeList of &lt;img&gt;"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> images <span class="token operator">=</span> Flickr<span class="token punctuation">.</span><span class="token function">_responseToImages</span><span class="token punctuation">(</span>sampleResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token function">assert</span><span class="token punctuation">(</span>images<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">assert</span><span class="token punctuation">(</span>images<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>nodeName <span class="token operator">===</span> <span class="token string">'IMG'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">assert</span><span class="token punctuation">(</span>images<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>src <span class="token operator">===</span> <span class="token string">'lolcat.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'.flickr'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// Intercept calls to fetch(url) and return a Promise</span>
    <span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
      sinon<span class="token punctuation">.</span><span class="token function">stub</span><span class="token punctuation">(</span>global<span class="token punctuation">,</span> <span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">jsonResponse</span><span class="token punctuation">(</span>sampleResponse<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true">// Put that thing back where it came from or so help me!</span>
    <span class="token function">after</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
      global<span class="token punctuation">.</span>fetch<span class="token punctuation">.</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"returns a Promise that resolves with a NodeList of &lt;img&gt;"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>done<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
      Flickr<span class="token punctuation">.</span><span class="token function">flickr</span><span class="token punctuation">(</span><span class="token string">'cats'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>images<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">assert</span><span class="token punctuation">(</span>images<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assert</span><span class="token punctuation">(</span>images<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>nodeName <span class="token operator">===</span> <span class="token string">'IMG'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assert</span><span class="token punctuation">(</span>images<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>src <span class="token operator">===</span> <span class="token string">'dancing_pug.gif'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>Run our tests again with <code class=" language-javascript">npm test</code> and you should see three assuring green ticks.</p>
<pre class=" language-bash"><code class="bash  language-bash">Math
  <span class="token punctuation">.</span>floor
    ✓ rounds down to the nearest whole number

Flickr
  <span class="token punctuation">.</span>_responseToImages
    ✓ maps response JSON to a NodeList of <span class="token operator">&lt;</span>img<span class="token operator">&gt;</span>
  <span class="token punctuation">.</span>flickr
    ✓ returns a Promise that resolves with a NodeList of <span class="token operator">&lt;</span>img<span class="token operator">&gt;</span>


<span class="token number">3</span> passing <span class="token punctuation">(</span>67ms<span class="token punctuation">)</span>
</code></pre>
<p>Phew! We’ve successfully tested our little module and the functions that comprise it, learning about pure functions and how to use functional composition along the way.  We’ve separated the pure from the impure, it’s readable, comprised of small functions, and it’s well tested.  The code is <em>easier to read, understand, and modify</em> than the <em>unreasonably pure</em> example above and that’s my only aim when refactoring code.</p>
<p>Pure functions, use them.</p>
<h2 id="links">Links</h2>
<ul>
<li><a href="https://drboolean.gitbooks.io/mostly-adequate-guide/content/index.html">Professor Frisby’s Mostly Adequate Guide to Functional Programming – @drboolean</a> – This excellent free book on Functional Programming by Brian Lonsdorf is the best guide to FP I’ve come across.  A lot of the ideas and examples in this article have come from this book.</li>
<li><a href="http://eloquentjavascript.net/1st_edition/chapter6.html">Eloquent Javascript – Functional Programming @marijnjh</a> – Marijn Haverbeke’s book remains one of my all time favorite intros to programming and has a great chapter on functional programming too.</li>
<li><a href="http://underscorejs.org/docs/underscore.html">Underscore</a> – Digging into a utility library like Underscore,  <a href="https://lodash.com/">Lodash</a> or <a href="http://ramdajs.com/docs/">Ramda</a> is an important step in maturing as a developer. Understanding how to use these functions will drastically reduce the amount of code you need to write, and make your programs more declarative.</li>
</ul>
<p>—</p>
<p>That’s all for now!  Thanks for reading and I hope you have found this a good introduction to functional programming, refactoring and testing in JavaScript.  It’s an interesting paradigm that’s making waves at the moment, due largely to the growing popularity of libraries like <a href="https://facebook.github.io/react/">React</a>, <a href="http://redux.js.org/">Redux</a>, <a href="http://elm-lang.org/">Elm</a>, <a href="http://cycle.js.org/">Cycle</a> and <a href="http://reactivex.io/">ReactiveX</a> which encourage or enforce these patterns.</p>
<p>Jump in, the water is warm.</p>
  