---
title: "One weird trick that will change the way you code forever: JavaScript TDD"
description: "‘One weird trick’ is a cheesy title, I know. Originally I was using it as a draft placeholder title for a joke. But the more I thought about it, the more it seemed appropriate because it's true. Test Driven Development is one weird trick that will change the way you code forever. It will make you a more badass developer."
link: "http://jrsinclair.com/articles/2016/one-weird-trick-that-will-change-the-way-you-code-forever-javascript-tdd/"
saved: "2016-06-22 17:35:11"
---

        
        <div class="e-content entry-content">
          <p><em>This is a presentation delivered to the <a href="https://squiz.net/">Squiz</a> Melbourne Engineering team. It repeats some of the material I’ve covered in other posts. So apologies if you’re a regular reader and you’ve heard all this before.</em></p>

<h2 id="introduction">Introduction</h2>

<p><em>One weird trick</em> is a cheesy title, I know. Originally I was using it as a draft placeholder title for a joke. But the more I thought about it, the more it seemed appropriate because it’s true. Test Driven Development <em>is</em> one weird trick that will change the way you code forever (in a good way). I will explain why as we go on.</p>

<p>I’ve broken this talk up into three parts:</p>

<ul>
<li><em>Why</em> practice TDD?</li>
<li><em>What</em> is TDD? and</li>
<li><em>How</em> do you practice TDD?</li>
</ul>

<p>In the <em>how</em> section I’ll work through a step-by-step example of how to write a single function with TDD. It will be very brief, because I don’t have a lot of time, and I just want to give you a flavour of how TDD works. For now though, let’s start with the <em>why</em>.</p>

<h2 id="why">Why?</h2>

<p>I want to think back to some of those ‘oh cr*p’ moments in your coding career.</p>

<ul>
<li>Have you ever fixed a bug, only to find that it broke something horribly in another part of the system? And you had no idea until the client called support in a panic?</li>
<li>Have you ever been afraid to touch a complicated piece of code for fear that you might break it and never be able to fix it again? … Even though you wrote it?</li>
<li>Have you ever found a piece of code that you’re pretty sure wasn’t being used any more and should be deleted? But you left it there just in case?</li>
<li>Have you ever felt like your code was a tower made of soft-spaghetti, held together with <a href="https://en.wikipedia.org/wiki/Clag_(glue)">Clag glue</a> and wishes?</li>
</ul>

<p>If you haven’t, then you probably don’t need TDD. Or you haven’t been coding for very long.</p>

<p>What if all of these could be a thing of the past? Imagine going back to some old code and thinking “Actually, this code isn’t too bad. It feels clean. I know what’s going on. Whoever wrote this was a genius!”</p>

<p>Sounds like unicorns and rainbows, right? But bear with me. I really do want you take a moment and imagine what that would feel like. What would it be like to come back to some of your own code, months (or years) later and not have that “Ewww” reaction? How would it feel to be able to fix a bug and know <em>for sure</em> that it had been fixed, and that you didn’t break everything doing it? Imagine surprising yourself with some of the elegant coding solutions you write.</p>

<p>I know that sounds a bit dramatic and cheesy, but it <em>is</em> possible. It’s a side-effect that I wasn’t expecting when I started using TDD, but it’s something I’ve actually experienced. There are some projects I <em>look forward</em> to working on again because I know the code is clean and organised.</p>

<h3 id="excuses">Excuses</h3>

<p>Now, you may have heard of TDD before. And maybe you thought “Ah yes, testing. That’s definitely something I should do.” And then you didn’t do it. Anyone?</p>

<p>I hear that all the time. I think there are two reasons why:</p>

<ol>
<li><p>The first reason is that testing seems like an optional extra—gold plating; a nice-to-have. You don’t <em>need</em> the tests to have working code. And what’s the first thing to get dropped when a project starts getting behind? Those ‘superfluous’ tests, right? Why waste time on something that isn’t absolutely essential to getting the project completed?</p></li>
<li><p>The second reason we don’t practice TDD more often (I think) is because of the word ‘test’. Testing sounds tedious; boring; time-consuming. You’re under the pump and you’ve got to get this project out the door. You don’t have time to write tests on top of everything else that has to get done. It seems like a nice-to-have. It’s like doing your taxes—you might understand that it’s important, but it’s definitely not sexy or fun.</p></li>
</ol>

<p>I felt the same way about TDD. But so many smart people seemed to be saying it was a good idea that I reluctantly gave it a go. And eventually I discovered a secret:</p>

<blockquote>
<p>Test Driven Development is not about testing.</p>
</blockquote>

<p>Did I just blow your mind? Let me elaborate a little:</p>

<blockquote>
<p>Test Driven Development is not about testing. It is a way of thinking and coding that just-so-happens to involve tests.</p>
</blockquote>

<p>What do I mean by this? What is it about then, if it’s not about the tests?</p>

<p>TDD is a technique that gives you confidence in your code. It’s a life-hack. It’s not really about the tests. Those are just a useful side-effect. The real benefit of TDD is the way it teaches you to think about code, and the confidence it gives you to know that your code definitely works.</p>

<h3 id="moreexcuses">More excuses</h3>

<p><em>Doesn’t TDD slow you down and make you less creative?</em></p>

<p>The short answer is no. Yeah, TDD seems slower at first. And when you start out it does take more time as you get used to it—just like any new skill. But as you go on it starts saving you more and more time. This is because you spend less time figuring out why things are broken and more time getting things done.</p>

<p>In turn, spending less time bug-hunting gives you more time for creativity and refactoring. If you’re practicing TDD properly, it encourages you to try the stupid-simple dead-obvious thing first, and see if it works. It allows you to try things with less risk of blowing everything up.</p>

<p>And one more thing before I go any further:</p>

<blockquote>
<p>Test Driven Development is not the same thing as unit tests. Unit tests are a type of test. TDD is a coding technique.</p>
</blockquote>

<p>In our organisation, we have a bad habit of referring to TDD as ‘unit testing’ (and I’m just as guilty as anybody). But they are not the same thing. Unit testing is a particular type of test that we use frequently for TDD (hence the confusion), but it’s not the only type of test. I’m trying really hard to stop using the two interchangeably, so if I do, please let me know.</p>

<p>But if TDD is not about tests, and it’s not the same as unit testing, what is it, exactly?</p>

<h2 id="what">What?</h2>

<p>TDD is a technique for writing code where you write a test before you write any ‘proper’ code. But that’s just the single-sentence summary. In the book <em>Test-Driven Development By Example</em>, Kent Beck explains that TDD has two simple rules that imply three simple steps. The rules are:</p>

<blockquote>
<ol>
<li>Write new code only if you first have a failing automated test.</li>
<li>Eliminate duplication.</li>
</ol>
</blockquote>

<p>And the three steps follow on from the two rules:</p>

<blockquote>
<ol>
<li><strong>Red</strong>—write a little test that doesn’t work, perhaps doesn’t even compile at&nbsp;first</li>
<li><strong>Green</strong>—make the test work quickly, committing whatever sins necessary in the&nbsp;process</li>
<li><strong>Refactor</strong>—eliminate all the duplication created in just getting the test to&nbsp;work<a href="http://jrsinclair.com/articles/2016/one-weird-trick-that-will-change-the-way-you-code-forever-javascript-tdd/?utm_source=SitePoint&amp;utm_medium=email&amp;utm_campaign=Versioning#fn:1" id="fnref:1" title="see footnote" class="footnote">[1]</a></li>
</ol>
</blockquote>

<p>These steps are fairly simple, but when followed they produce some powerful results, so long as you are <a href="http://jrsinclair.com/articles/2016/tdd-should-be-fun/">using your brain</a>. As I said, the real value is not in the tests themselves, but in the way it teaches you to think about coding, and the confidence it gives you in your code. To show how that works, we’ll run through a very short example:</p>

<h2 id="how">How?</h2>

<p>Imagine we’re going to create the following application:</p>

<figure>
<img src="http://jrsinclair.com/assets/pugs-of-flickr-web-application-screenshot.png?v=108651" alt="Screenshot of a web application hosted on codepen.io, showing pictures of pugs, styled to look like polaroid photographs.">
<figcaption>The Pugs of Flickr Web Application</figcaption>
</figure>

<p>All it does is connect to the Flickr API and find the latest pictures of Pugs. I’m not going to run through building the whole application, but just a single step. We will pick one function from one module and build just that. (If you’re interested <a href="http://jrsinclair.com/articles/2016/gentle-introduction-to-javascript-tdd-intro/">I’ve written out a step-by-step tutorial for building the whole application with TDD</a>).</p>

<p>So, before we do anything, let’s set up the project. First we’ll need a folder to work in, so let’s create that:</p>

<pre class=" line-numbers"><code class="language-bash">cd /path/to/my/projects/folder
mkdir pugs-of-flickr
cd pugs-of-flickr
</code></pre>

<p>Next we’ll install <a href="http://mochajs.org/">Mocha</a>, the testing framework we’ll be using (if you don’t have it already). And we’ll install <a href="http://chaijs.com/">Chai</a> locally–a module that helps write assertions in a more readable fashion. (Assertion is just a fancy name for <em>the bit that does the actual test, as opposed to all the setup stuff</em>):</p>

<pre class=" line-numbers"><code class="language-bash">npm install -g mocha
npm install chai
</code></pre>

<p>Then, we create a file for our tests:</p>

<pre class=" line-numbers"><code class="language-bash">touch flickr-fetcher-spec.js
</code></pre>

<p>The file name is just the name of the module with <code>-spec</code> added on the end.</p>

<p>In my file I set up my very first test as follows:</p>

<pre class=" line-numbers  language-javascript"><code class="  language-javascript"><span class="token comment" spellcheck="true">// flickr-fetcher-spec.js</span>
<span class="token comment" spellcheck="true">/*eslint-env mocha*/</span>
<span class="token keyword">var</span> expect <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'chai'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>expect<span class="token punctuation">;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'FlickrFetcher'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should exist'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./flickr-fetcher'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span>defined<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>This test is super-simple. It does nothing other than check that my module exists. That’s it. The <code>describe()</code> function says “I’m starting a new group of tests here”, and the <code>it()</code> function says “Here’s one test”.</p>

<p>So, I run my test suite like so:</p>

<pre class=" line-numbers"><code class="language-bash">mocha -R nyan ./flickr-fetcher-spec.js
</code></pre>

<p>…and we get a sad cat. We have completed <strong>Step 1—Red.</strong>
This is good news, because it means I can move forward. So, step two is to make the test pass. What’s the simplest possible thing I can do to make that test pass?</p>

<p>The simplest thing is to create the module:</p>

<pre class=" line-numbers  language-javascript"><code class="  language-javascript"><span class="token comment" spellcheck="true">// flickr-fetcher.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>I run my test again… and I have a happy cat. <strong>Step 2—Green</strong> is complete. So we’re up to the refactoring step.</p>

<p>Is there any duplication going on here? Not yet. Is there anything I could do to improve the code? Maybe. I’ll tweak things just a little:</p>

<pre class=" line-numbers  language-javascript"><code class="  language-javascript"><span class="token comment" spellcheck="true">// flickr-fetcher.js</span>
<span class="token keyword">var</span> FlickrFetcher <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> FlickrFetcher<span class="token punctuation">;</span>
<span class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>This makes it a bit clearer what’s going on without adding any new (untested) functionality.</p>

<p>And I run my test again… and the cat is still happy. So we’ve completed <strong>Step 3—Refactoring</strong>.</p>

<p>Let’s do something a little bit more useful (and more instructive). The Flickr API gives us photo data in JSON form. It doesn’t give us URLs for the images (because we have to tell it what size we want). So, we need a function that will take a photo object and transform it into a URL. Photo objects look like this:</p>

<pre class=" line-numbers  language-javascript"><code class="  language-javascript"><span class="token punctuation">{</span>
    <span class="token string">"id"</span><span class="token punctuation">:</span>       <span class="token string">"25373736106"</span><span class="token punctuation">,</span>
    <span class="token string">"owner"</span><span class="token punctuation">:</span>    <span class="token string">"99117316@N03"</span><span class="token punctuation">,</span>
    <span class="token string">"secret"</span><span class="token punctuation">:</span>   <span class="token string">"146731fcb7"</span><span class="token punctuation">,</span>
    <span class="token string">"server"</span><span class="token punctuation">:</span>   <span class="token string">"1669"</span><span class="token punctuation">,</span>
    <span class="token string">"farm"</span><span class="token punctuation">:</span>     <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token string">"title"</span><span class="token punctuation">:</span>    <span class="token string">"Dog goes to desperate measure to avoid walking on a leash"</span><span class="token punctuation">,</span>
    <span class="token string">"ispublic"</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token string">"isfriend"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token string">"isfamily"</span><span class="token punctuation">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
<span class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>We want a URL that looks like this:</p>

<pre class=" line-numbers"><code class="language-text">https://farm2.staticflickr.com/1669/25373736106_146731fcb7_b.jpg
</code></pre>

<p>The Flickr API documentation describes the way we make the transform using the following template:</p>

<pre class=" line-numbers"><code class="language-text">https://farm{farm-id}.staticflickr.com/{server-id}/{id}_{secret}_[mstzb].jpg
</code></pre>

<p>So, that gives us enough information to write a test:</p>

<pre class=" line-numbers  language-javascript"><code class="  language-javascript"><span class="token comment" spellcheck="true">// flickr-fetcher-spec.js</span>
<span class="token comment" spellcheck="true">/*eslint-env mocha*/</span>
<span class="token keyword">var</span> expect <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'chai'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>expect<span class="token punctuation">;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'FlickrFetcher'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should exist'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./flickr-fetcher'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span>defined<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> FlickrFetcher <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./flickr-fetcher'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'#photoObjToURL()'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should take a photo object and return a URL'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> input <span class="token operator">=</span> <span class="token punctuation">{</span>
                    id<span class="token punctuation">:</span>       <span class="token string">'25373736106'</span><span class="token punctuation">,</span>
                    owner<span class="token punctuation">:</span>    <span class="token string">'99117316@N03'</span><span class="token punctuation">,</span>
                    secret<span class="token punctuation">:</span>   <span class="token string">'146731fcb7'</span><span class="token punctuation">,</span>
                    server<span class="token punctuation">:</span>   <span class="token string">'1669'</span><span class="token punctuation">,</span>
                    farm<span class="token punctuation">:</span>     <span class="token number">2</span><span class="token punctuation">,</span>
                    title<span class="token punctuation">:</span>    <span class="token string">'Dog goes to desperate measure to avoid walking on a leash'</span><span class="token punctuation">,</span>
                    ispublic<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                    isfriend<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                    isfamily<span class="token punctuation">:</span> <span class="token number">0</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                actual   <span class="token operator">=</span> FlickrFetcher<span class="token punctuation">.</span><span class="token function">photoObjToURL</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">,</span>
                expected <span class="token operator">=</span> <span class="token string">'https://farm2.staticflickr.com/1669/25373736106_146731fcb7_b.jpg'</span><span class="token punctuation">;</span>
            <span class="token function">expect</span><span class="token punctuation">(</span>actual<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>expected<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>This just passes the example photo object into the new function, then checks that the actual output matches what we expect. Most of your tests should look roughly like that. You define an <code>input</code>, the <code>actual</code> value, and the <code>expected</code> value. Then you check to see if the actual result matched what you expected.</p>

<p>Let’s run the test… sad cat (red). So, we can write some code.</p>

<p>Now, what’s the quickest, simplest, easiest way to make this test pass? You guessed it: Return the URL we expect.</p>

<pre class=" line-numbers  language-javascript"><code class="  language-javascript"><span class="token comment" spellcheck="true">// flickr-fetcher.js</span>
<span class="token keyword">var</span> FlickrFetcher <span class="token operator">=</span> <span class="token punctuation">{</span>

    photoObjToURL<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">'https://farm2.staticflickr.com/1669/25373736106_146731fcb7_b.jpg'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> FlickrFetcher<span class="token punctuation">;</span>
<span class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Run the tests again, and… happy cat. That’s it. Test passes, we’re done. But let’s pause a moment and talk about what we just did there: Creating an almost useless function that still passes the test. This was the part I didn’t understand when I first started practicing TDD. You write only enough code to make the test pass. No more.</p>

<p>And it’s really hard. This is the main reason why it feels like TDD slows you down. It takes a lot of discipline to <em>only</em> write the bare minimum code. If you’re like me, you <em>just know</em> how to write the code, and have all sorts of ideas for making it super-efficient and elegant. But there’s no point in writing more code than you have to. Doing TDD right means restraining yourself and only writing enough code to make the test pass.</p>

<p>Let’s keep going…</p>

<p>This function is not complete. What happens if we pass a different photo object? Let’s find out… by writing a new test.</p>

<pre class=" line-numbers  language-javascript"><code class="  language-javascript"><span class="token comment" spellcheck="true">// flickr-fetcher-spec.js</span>
<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'#photoObjToURL()'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should take a photo object and return a URL'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> input <span class="token operator">=</span> <span class="token punctuation">{</span>
                id<span class="token punctuation">:</span>       <span class="token string">'25373736106'</span><span class="token punctuation">,</span>
                owner<span class="token punctuation">:</span>    <span class="token string">'99117316@N03'</span><span class="token punctuation">,</span>
                secret<span class="token punctuation">:</span>   <span class="token string">'146731fcb7'</span><span class="token punctuation">,</span>
                server<span class="token punctuation">:</span>   <span class="token string">'1669'</span><span class="token punctuation">,</span>
                farm<span class="token punctuation">:</span>     <span class="token number">2</span><span class="token punctuation">,</span>
                title<span class="token punctuation">:</span>    <span class="token string">'Dog goes to desperate measure to avoid walking on a leash'</span><span class="token punctuation">,</span>
                ispublic<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                isfriend<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                isfamily<span class="token punctuation">:</span> <span class="token number">0</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            actual   <span class="token operator">=</span> FlickrFetcher<span class="token punctuation">.</span><span class="token function">photoObjToURL</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">,</span>
            expected <span class="token operator">=</span> <span class="token string">'https://farm2.staticflickr.com/1669/25373736106_146731fcb7_b.jpg'</span><span class="token punctuation">;</span>
        <span class="token function">expect</span><span class="token punctuation">(</span>actual<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>expected<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Second test with a different object.</span>
        input <span class="token operator">=</span> <span class="token punctuation">{</span>
            id<span class="token punctuation">:</span>       <span class="token string">'24765033584'</span><span class="token punctuation">,</span>
            owner<span class="token punctuation">:</span>    <span class="token string">'27294864@N02'</span><span class="token punctuation">,</span>
            secret<span class="token punctuation">:</span>   <span class="token string">'3c190c104e'</span><span class="token punctuation">,</span>
            server<span class="token punctuation">:</span>   <span class="token string">'1514'</span><span class="token punctuation">,</span>
            farm<span class="token punctuation">:</span>     <span class="token number">2</span><span class="token punctuation">,</span>
            title<span class="token punctuation">:</span>    <span class="token string">'the other cate'</span><span class="token punctuation">,</span>
            ispublic<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            isfriend<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            isfamily<span class="token punctuation">:</span> <span class="token number">0</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        expected <span class="token operator">=</span> <span class="token string">'https://farm2.staticflickr.com/1514/24765033584_3c190c104e_b.jpg'</span><span class="token punctuation">;</span>
        actual   <span class="token operator">=</span> FlickrFetcher<span class="token punctuation">.</span><span class="token function">photoObjToURL</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">expect</span><span class="token punctuation">(</span>actual<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>expected<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Run the test again… and it fails, as expected. So… what’s the simplest, shortest way to make this test pass? Yep. An if-statement.</p>

<pre class=" line-numbers  language-javascript"><code class="  language-javascript"><span class="token comment" spellcheck="true">// flickr-fetcher.js</span>
<span class="token keyword">var</span> FlickrFetcher <span class="token operator">=</span> <span class="token punctuation">{</span>

    photoObjToURL<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>photoObj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>photoObj<span class="token punctuation">.</span>id <span class="token operator">===</span> <span class="token string">'25373736106'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">'https://farm2.staticflickr.com/1669/25373736106_146731fcb7_b.jpg'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token string">'https://farm2.staticflickr.com/1514/24765033584_3c190c104e_b.jpg'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> FlickrFetcher<span class="token punctuation">;</span>
<span class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>We run the test again, and… happy cat (green). Are you getting frustrated yet? Don’t you just want to get in there and write the whole function? Bear with me, and think about the next step—refactoring. Could this code be any more efficient to past these tests? Well, no, not really. But the next question is very important. Is there any duplication here? …</p>

<p>Actually, yes, there is. But just to drive the point home, let’s add one more test.</p>

<pre class=" line-numbers  language-javascript"><code class="  language-javascript"><span class="token comment" spellcheck="true">// Third test with a different object.</span>
input <span class="token operator">=</span> <span class="token punctuation">{</span>
    id<span class="token punctuation">:</span>       <span class="token string">'24770505034'</span><span class="token punctuation">,</span>
    owner<span class="token punctuation">:</span>    <span class="token string">'97248275@N03'</span><span class="token punctuation">,</span>
    secret<span class="token punctuation">:</span>   <span class="token string">'31a9986429'</span><span class="token punctuation">,</span>
    server<span class="token punctuation">:</span>   <span class="token string">'1577'</span><span class="token punctuation">,</span>
    farm<span class="token punctuation">:</span>     <span class="token number">2</span><span class="token punctuation">,</span>
    title<span class="token punctuation">:</span>    <span class="token string">'Some pug picture'</span><span class="token punctuation">,</span>
    ispublic<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    isfriend<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    isfamily<span class="token punctuation">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
expected <span class="token operator">=</span> <span class="token string">'https://farm2.staticflickr.com/1577/24770505034_31a9986429_b.jpg'</span><span class="token punctuation">;</span>
actual   <span class="token operator">=</span> FlickrFetcher<span class="token punctuation">.</span><span class="token function">photoObjToURL</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">expect</span><span class="token punctuation">(</span>actual<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>expected<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Run the tests again… and sad cat (red). We can write some code. What’s the quickest, simplest way to get this code to pass then? Yep, another if-statement. Remember, we’re “committing whatever sins necessary in the process” to make the test pass:</p>

<pre class=" line-numbers  language-javascript"><code class="  language-javascript"><span class="token comment" spellcheck="true">// flickr-fetcher.js</span>
<span class="token keyword">var</span> FlickrFetcher <span class="token operator">=</span> <span class="token punctuation">{</span>

    photoObjToURL<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>photoObj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>photoObj<span class="token punctuation">.</span>id <span class="token operator">===</span> <span class="token string">'25373736106'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">'https://farm2.staticflickr.com/1669/25373736106_146731fcb7_b.jpg'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>photoObj<span class="token punctuation">.</span>id <span class="token operator">===</span> <span class="token string">'24765033584'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">'https://farm2.staticflickr.com/1514/24765033584_3c190c104e_b.jpg'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token string">'https://farm2.staticflickr.com/1577/24770505034_31a9986429_b.jpg'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> FlickrFetcher<span class="token punctuation">;</span>
<span class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>If we run the test again, the cat is happy (green). So, we’re up to the refactoring stage.</p>

<p><em>Now,</em> do we have duplication going on?</p>

<p>Heck yes!</p>

<p>Let’s refactor:</p>

<pre class=" line-numbers  language-javascript"><code class="  language-javascript"><span class="token comment" spellcheck="true">// flickr-fetcher.js</span>
<span class="token keyword">var</span> FlickrFetcher <span class="token operator">=</span> <span class="token punctuation">{</span>

    photoObjToURL<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>photoObj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span> <span class="token string">'https://farm'</span><span class="token punctuation">,</span>
            photoObj<span class="token punctuation">.</span>farm<span class="token punctuation">,</span> <span class="token string">'.staticflickr.com/'</span><span class="token punctuation">,</span>
            photoObj<span class="token punctuation">.</span>server<span class="token punctuation">,</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
            photoObj<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token string">'_'</span><span class="token punctuation">,</span>
            photoObj<span class="token punctuation">.</span>secret<span class="token punctuation">,</span> <span class="token string">'_b.jpg'</span>
        <span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> FlickrFetcher<span class="token punctuation">;</span>
<span class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Now, isn’t that much nicer? Does it work? Let’s re-run the tests… …and happy cat (green).</p>

<p>Let’s savour that for a moment. We have some nice efficient code, that we know works, because we’ve got three separate tests verifying it.</p>

<p>But, we’re not done refactoring yet… do we still have duplication going on? Yep. There’s a whole bunch of it in our tests. So let’s refactor those:</p>

<pre class=" line-numbers  language-javascript"><code class="  language-javascript"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'#photoObjToURL()'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should take a photo object and return a URL'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> testCases <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                input<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                    id<span class="token punctuation">:</span>       <span class="token string">'25373736106'</span><span class="token punctuation">,</span>
                    owner<span class="token punctuation">:</span>    <span class="token string">'99117316@N03'</span><span class="token punctuation">,</span>
                    secret<span class="token punctuation">:</span>   <span class="token string">'146731fcb7'</span><span class="token punctuation">,</span>
                    server<span class="token punctuation">:</span>   <span class="token string">'1669'</span><span class="token punctuation">,</span>
                    farm<span class="token punctuation">:</span>     <span class="token number">2</span><span class="token punctuation">,</span>
                    title<span class="token punctuation">:</span>    <span class="token string">'Dog goes to desperate measure to avoid walking on a leash'</span><span class="token punctuation">,</span>
                    ispublic<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                    isfriend<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                    isfamily<span class="token punctuation">:</span> <span class="token number">0</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                expected<span class="token punctuation">:</span> <span class="token string">'https://farm2.staticflickr.com/1669/25373736106_146731fcb7_b.jpg'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                input<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                    id<span class="token punctuation">:</span>       <span class="token string">'24765033584'</span><span class="token punctuation">,</span>
                    owner<span class="token punctuation">:</span>    <span class="token string">'27294864@N02'</span><span class="token punctuation">,</span>
                    secret<span class="token punctuation">:</span>   <span class="token string">'3c190c104e'</span><span class="token punctuation">,</span>
                    server<span class="token punctuation">:</span>   <span class="token string">'1514'</span><span class="token punctuation">,</span>
                    farm<span class="token punctuation">:</span>     <span class="token number">2</span><span class="token punctuation">,</span>
                    title<span class="token punctuation">:</span>    <span class="token string">'the other cate'</span><span class="token punctuation">,</span>
                    ispublic<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                    isfriend<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                    isfamily<span class="token punctuation">:</span> <span class="token number">0</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                expected<span class="token punctuation">:</span> <span class="token string">'https://farm2.staticflickr.com/1514/24765033584_3c190c104e_b.jpg'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                input<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                    id<span class="token punctuation">:</span>       <span class="token string">'24770505034'</span><span class="token punctuation">,</span>
                    owner<span class="token punctuation">:</span>    <span class="token string">'97248275@N03'</span><span class="token punctuation">,</span>
                    secret<span class="token punctuation">:</span>   <span class="token string">'31a9986429'</span><span class="token punctuation">,</span>
                    server<span class="token punctuation">:</span>   <span class="token string">'1577'</span><span class="token punctuation">,</span>
                    farm<span class="token punctuation">:</span>     <span class="token number">2</span><span class="token punctuation">,</span>
                    title<span class="token punctuation">:</span>    <span class="token string">'Some pug picture'</span><span class="token punctuation">,</span>
                    ispublic<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                    isfriend<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                    isfamily<span class="token punctuation">:</span> <span class="token number">0</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                expected<span class="token punctuation">:</span> <span class="token string">'https://farm2.staticflickr.com/1577/24770505034_31a9986429_b.jpg'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>
        testCases<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> actual <span class="token operator">=</span> FlickrFetcher<span class="token punctuation">.</span><span class="token function">photoObjToURL</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">expect</span><span class="token punctuation">(</span>actual<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>expected<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Now our tests are nice and clean too. We run them again and we still have a happy cat (green). Everything is nice and tidy and efficient.</p>

<h2 id="finalthoughts">Final thoughts</h2>

<p>I’m hoping after this that you’ll give TDD a go. But I have one final word of advice: <em>Start small</em>. Don’t try and do everything at once. Pick one small, easy bit of a project and do TDD with that. If it’s easier to <a href="http://codepen.io/jrsinclair/pen/mEEwWQ">set something up in a Code Pen</a>, then do that.</p>

<p>Once you’re comfortable with the three steps, then start thinking about how you can bring more stuff into tests. Think about how to restructure your code to make it easier to test. Slowly, all your code will start to improve. And, as you practice, you <em>will</em> become a better developer because you will learn to see the code differently.</p>

<h2 id="moreresources">More resources</h2>

<p>I’ve written about TDD before on my website. There’s a step-by-step tutorial and some advice on where people get stuck:</p>

<ul>
<li><a href="http://jrsinclair.com/articles/2016/gentle-introduction-to-javascript-tdd-intro/">A Gentle Introduction to JavaScript Test Driven Development</a></li>
<li><a href="http://jrsinclair.com/articles/2016/tdd-should-be-fun/">TDD Should be Fun</a></li>
</ul>

<p>If you’d prefer advice from someone who isn’t me, check out Eric Elliot’s helpful articles:</p>

<ul>
<li><a href="https://medium.com/javascript-scene/what-every-unit-test-needs-f6cd34d9836d">5 Questions Every Unit Test Must Answer</a></li>
<li><a href="https://www.sitepoint.com/javascript-testing-unit-functional-integration/">JavaScript Testing: Unit vs Functional vs Integration Tests</a></li>
<li><a href="https://medium.com/javascript-scene/5-common-misconceptions-about-tdd-unit-tests-863d5beb3ce9">5 Common Misconceptions About TDD &amp; Unit Tests</a></li>
<li><a href="https://medium.com/javascript-scene/why-i-use-tape-instead-of-mocha-so-should-you-6aa105d8eaf4">Why I use Tape Instead of Mocha &amp; So Should You</a></li>
</ul>

<p>Or Rebecca Murphey:</p>

<ul>
<li><a href="http://alistapart.com/article/writing-testable-javascript">Writing Testable JavaScript (on A List Apart)</a></li>
<li><a href="https://rmurphey.com/blog/2014/07/13/unit-tests">Writing Unit Tests for Existing JavaScript</a></li>
</ul>

<div class="footnotes">
<hr>
<ol>

<li id="fn:1">
<p>Kent Beck, 2002, <a href="http://smile.amazon.com/dp/0321146530"><em>Test-Driven Development by Example</em></a> <a href="http://jrsinclair.com/articles/2016/one-weird-trick-that-will-change-the-way-you-code-forever-javascript-tdd/?utm_source=SitePoint&amp;utm_medium=email&amp;utm_campaign=Versioning#fnref:1" title="return to article" class="reversefootnote">&nbsp;↩</a></p>
</li>

</ol>
</div>
        </div>
        
      