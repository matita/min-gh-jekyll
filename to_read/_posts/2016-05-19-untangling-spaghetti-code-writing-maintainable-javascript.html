---
title: "Untangling Spaghetti Code: Writing Maintainable JavaScript"
description: "Refactoring a legacy code base? Moritz Kröger shows you how to achieve maintainable JavaScript with tests, linting and modularization. "
link: "https://www.sitepoint.com/write-maintainable-javascript/"
saved: "2016-05-19 16:59:53"
---

    <p><em>This article was peer reviewed by <a href="http://www.sitepoint.com/author/tgreco/">Tom Greco</a>, <a href="http://www.sitepoint.com/author/dprince/">Dan Prince</a> and <a href="http://www.sitepoint.com/author/yberhanu/">Yaphi Berhanu</a>. Thanks to all of SitePoint’s peer reviewers for making SitePoint content the best it can be!</em></p>
<p>Almost every developer has had the experience of maintaining or taking over a legacy project. Or, maybe it’s an old project which got picked up again. Common first thoughts are to throw away the code base, and start from scratch. The code can be messy, undocumented and it can take days to fully understand everything. But, with proper planning, analysis, and a good workflow, it is possible to turn a spaghetti codebase into a clean, organised, and scalable one.</p>
<div class="ArticleBox u-inline"><h3 class="ArticleBox_header t-bg">
                    <span class="ArticleBox_icon fa fa-pencil"></span> More from this author
                 </h3><div class="ArticleBox_content"><ul class="ArticleBox_list t-list"><li><a href="https://www.sitepoint.com/write-atom-packages-using-vanilla-javascript/?utm_source=sitepoint&amp;utm_medium=relatedinline&amp;utm_term=javascript&amp;utm_campaign=relatedauthor">How to Write Atom Packages Using Vanilla JavaScript</a></li></ul></div></div>
<p>I’ve had to take over and clean-up a lot of projects. There haven’t been many I started from scratch. In fact, I am currently doing exact that. I’ve learned a lot regarding JavaScript, keeping a codebase organised and — most importantly — <em>not being mad</em> at the previous developer. In this article I want to show you my steps and tell you my experience.</p>
<h2 id="analysetheproject">Analyse the Project</h2>
<p>The very first step is to get an overview of what is going on. If it’s a website, click your way through all the functionality: open modals, send forms and so on. While doing that, have the Developer Tools open, to see if any errors are popping up or anything is getting logged. If it’s a Node.js project, open the <a href="https://en.wikipedia.org/wiki/Command-line_interface">command line interface</a> and go through the API. In the best case the project has an entry point (e.g. <code class=" language-javascript">main<span class="token punctuation">.</span>js</code>, <code class=" language-javascript">index<span class="token punctuation">.</span>js</code>, <code class=" language-javascript">app<span class="token punctuation">.</span>js</code>, …) where either all modules are initialized or, in the worst case, the entire business logic is located.</p>
<p>Find out which tools are in use. <a href="https://jquery.com/">jQuery</a>? <a href="https://facebook.github.io/react/">React</a>? <a href="http://expressjs.com/">Express</a>? Make a list of everything that is important to know. Let’s say the project is written in <a href="https://angular.io/">Angular 2</a> and you haven’t worked with that, go straight to the documentation and get a basic understanding. Search for best practices.</p>
<h3 id="understandtheprojectonahigherlevel">Understand the Project on a Higher Level</h3>
<p>Knowing the technologies is a good start, but to get a real feel and understanding, it’s time to look into the <a href="https://en.wikipedia.org/wiki/Unit_testing"><strong>unit tests</strong></a>. Unit testing is a way of testing functionality and the methods of your code to ensure your code behaves as intended. Reading — and running — unit tests gives you a much deeper understanding than reading only code. If they are no unit tests in your project, don’t worry, we will come to that.</p>
<h2 id="createabaseline">Create a Baseline</h2>
<p>This is all about establishing <strong>consistency</strong>. Now that you have all information about the projects toolchain, you know the structure and how the logic is connected, it’s time to create a baseline. I recommend adding an <a href="http://editorconfig.org/"><code class=" language-javascript"><span class="token punctuation">.</span>editorconfig</code></a> file to keep coding style guides consistent between different editors, IDE’s, and developers.</p>
<h3 id="coherentindentation">Coherent indentation</h3>
<p>The <a href="http://programmers.stackexchange.com/questions/57/tabs-versus-spaces-what-is-the-proper-indentation-character-for-everything-in-e">famous question</a> (it’s rather a <em>war</em> though), whether spaces or tabs should be used, doesn’t matter. Is the codebase written in spaces? Continue with spaces. With tabs? Use them. Only when the codebase has mixed indentation is it necessary to decide which to use. Opinions are fine, but a good project makes sure all developer can work without hassle.</p>
<p>Why is this even important? Everyone has it’s own way of using an editor or IDE. For instance, I am a huge fan of <a href="https://en.wikipedia.org/wiki/Code_folding">code folding</a>. Without that feature, I am literally lost in a file. When the indentation isn’t coherent, this features fails. So every time I open a file, I would have to fix the indentation before I can even start working. This is a huge waste of time.</p>
<pre class=" language-javascript"><code class="javascript  language-javascript"><span class="token comment" spellcheck="true">// While this is valid JavaScript, the block can't</span>
<span class="token comment" spellcheck="true">// be properly folded due to its mixed indentation.</span>
 <span class="token keyword">function</span> foo <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> property <span class="token operator">=</span> <span class="token function">String</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>property <span class="token operator">===</span> <span class="token string">'bar'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   property <span class="token operator">=</span> <span class="token function">doSomething</span><span class="token punctuation">(</span>property<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment" spellcheck="true">//... more logic.</span>
 <span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// Correct indentation makes the code block foldable,</span>
<span class="token comment" spellcheck="true">// enabling a better experience and clean codebase.</span>
<span class="token keyword">function</span> foo <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">let</span> property <span class="token operator">=</span> <span class="token function">String</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token keyword">if</span> <span class="token punctuation">(</span>property <span class="token operator">===</span> <span class="token string">'bar'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  property <span class="token operator">=</span> <span class="token function">doSomething</span><span class="token punctuation">(</span>property<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token comment" spellcheck="true">//... more logic.</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="naming">Naming</h3>
<p>Make sure that the naming convention used in the project is respected. <a href="https://en.wikipedia.org/wiki/CamelCase">CamelCase</a> is commonly used in JavaScript code, but I’ve seen mixed conventions a lot. For instance, jQuery projects often have mixed naming of jQuery object variables and other variables.</p>
<pre class=" language-javascript"><code class="javascript  language-javascript"><span class="token comment" spellcheck="true">// Inconsistent naming makes it harder</span>
<span class="token comment" spellcheck="true">// to scan and understand the code. It can also</span>
<span class="token comment" spellcheck="true">// lead to false expectations.</span>
<span class="token keyword">const</span> $element <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.element'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> _privateMethod <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> self <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> _internalElement <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.internal-element'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> $data <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment" spellcheck="true">//... more logic.</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// This is much easier and faster to understand.</span>
<span class="token keyword">const</span> $element <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.element'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> _privateMethod <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> $<span class="token keyword">this</span> <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> $internalElement <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.internal-element'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> elementData <span class="token operator">=</span> $element<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment" spellcheck="true">//... more logic.</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="lintingeverything">Linting Everything</h3>
<p>While the previous steps were more cosmetic and mainly to help with scanning the code faster, here we introduce and ensure common best practices as well as code quality. <a href="http://eslint.org/">ESLint</a>, <a href="http://www.jslint.com/">JSLint</a>, and <a href="http://jshint.com/">JSHint</a> are the most popular JavaScript linters these days. Personally, I used to work with JSHint a lot, but ESLint has started to become my favorite, mainly because of its custom rules and early ES2015 support.</p>
<p>When you start linting, if a lot of errors pop up, fix them! Don’t continue with anything else before your linter is happy!</p>
<h3 id="updatingdependencies">Updating Dependencies</h3>
<p>Updating dependencies should be done carefully. It’s easy to introduce more errors when not paying attention to the changes your dependencies have gone through. Some projects might work with fixed versions (e.g. <code class=" language-javascript">v1<span class="token number">.12</span><span class="token punctuation">.</span><span class="token number">5</span></code>), while others use wildcard versions (e.g. <code class=" language-javascript">v1<span class="token number">.12</span><span class="token punctuation">.</span>x</code>). In case you need a quick update, a version number is constructed as follows: <code class=" language-javascript">MAJOR<span class="token punctuation">.</span>MINOR<span class="token punctuation">.</span>PATCH</code>. If you aren’t familiar with how <a href="http://semver.org/">semantic versioning</a> works, I recommend reading <a href="https://nodesource.com/blog/semver-a-primer/">this article</a> by Tim Oxley.</p>
<p>There is no general rule for updating dependencies. Each project is different and should be handled as such. Updating the <code class=" language-javascript">PATCH</code> number of your dependencies shouldn’t be a problem at all, and <code class=" language-javascript">MINOR</code> is usually fine too. Only when you bump the <code class=" language-javascript">MAJOR</code> number of your dependencies, you should look up what exactly has changed. Maybe the API has changed entirely and you need to rewrite large parts of your application. If that’s not worth the effort, I would avoid updating to the next major version.</p>
<p>If your project uses <a href="https://www.npmjs.com/">npm</a> as dependency manager (and there aren’t any competitors) you can check for any outdated dependencies with the handy <code class=" language-javascript">npm outdated</code> command from your CLI. Let me illustrate this with an example from one of my  projects called <a href="https://github.com/morkro/FrontBook">FrontBook</a>, where I frequently update all dependencies:</p>
<p><img src="https://dab1nmslvvntp.cloudfront.net/wp-content/uploads/2016/04/1459594112npm-outdated.png" alt="Image of npm outdated"></p>
<p>As you can see I have a lot of major updates here. I wouldn’t update all of them at once, but one at a time. Granted, this will take up a lot of time, yet it is the only way to ensure nothing breaks (if the project doesn’t have any tests).</p>
<h2 id="letsgetourhandsdirty">Let’s Get Our Hands Dirty</h2>
<p>The main message I want you to take with you is that cleaning up doesn’t necessarily mean removing and rewriting large sections of code. Of course, this is sometimes the only solution but it shouldn’t be your first and only step. JavaScript can be an odd language, hence giving generic advice is usually not possible. You always have to evaluate your specific situation and figure out a working solution.</p>
<h3 id="establishunittests">Establish Unit Tests</h3>
<p>Having unit tests ensures you understand how the code is intended to work and you don’t accidentily break anything. JavaScript unit testing is worth its own articles, so I won’t be able to go much into detail here. Widely used frameworks are <a href="http://karma-runner.github.io/0.13/index.html">Karma</a>, <a href="http://jasmine.github.io/">Jasmine</a>, <a href="http://mochajs.org/">Mocha</a> or <a href="https://github.com/sindresorhus/ava">Ava</a>. If you also want to test your user interface, <a href="http://nightwatchjs.org/">Nightwatch.js</a> and <a href="http://dalekjs.com/">DalekJS</a> are recommended browser automation tools.</p>
<p>The difference between unit testing and browser automation is, that the former tests your JavaScript code itself. It ensures all your modules and general logic work as intended. Browser automation, on the other hand, tests the surface — the user interface — of your project, making sure elements are in the right place and work as expected.</p>
<p>Take care of unit tests before you start refactoring anything else. The stability of your project will improve, and you haven’t even thought about scalability! A great side effect is not being worried all the time that you might have broken something and didn’t notice.</p>
<p>Rebecca Murphey as written an excellent article on <a href="https://rmurphey.com/blog/2014/07/13/unit-tests">writing unit tests for existing JavaScript</a>.</p>
<h3 id="architecture">Architecture</h3>
<p>JavaScript architecture is another huge topic. Refactoring and cleaning up the architecture boils down to how much experience you have with doing that. We have a lot of different <a href="https://addyosmani.com/resources/essentialjsdesignpatterns/book/">design patterns</a> in software development, but not all of them are a good fit where scalability is concerned. Unfortunately I won’t be able to cover all of the cases in this article, but can at least give you some general advice.</p>
<p>First of all, you should figure out which design patterns are already used in your project. Read up about the pattern, and ensure it’s consistent. One of the keys to scalability is sticking to the pattern, and not mixing methodologies. Of course, you can have different design patterns for different purposes in your project (e.g. using the <a href="https://addyosmani.com/resources/essentialjsdesignpatterns/book/#singletonpatternjavascript">Singleton Pattern</a> for data structures or short namespaced helper functions, and the <a href="https://addyosmani.com/resources/essentialjsdesignpatterns/book/#observerpatternjavascript">Observer Pattern</a> for your modules) but should never write one module with one pattern, and another one with a different pattern.</p>
<p>If there isn’t really any architecture in your project (maybe everything is just in one huge <code class=" language-javascript">app<span class="token punctuation">.</span>js</code>), it’s time to change that. Don’t do it all at once, but piece by piece. Again, there is no generic way to do things and every project setup is different. Folder structures varies between projects, depending on the size and complexity. Usually — on a very basic level — the structure is split up into third-party libraries, modules, data and an entry-point (e.g. <code class=" language-javascript">index<span class="token punctuation">.</span>js</code>, <code class=" language-javascript">main<span class="token punctuation">.</span>js</code>) where all your modules and logic gets initialized.</p>
<p>This leads me to <strong>modularization</strong>.</p>
<h3 id="modularizeeverything">Modularize Everything?</h3>
<p>Modularization is by far not the answer to the great JavaScript scalability question. It adds another layer of API that developers have to get familiar with. This can be worth the hassle though. The principle is splitting up all your functionality in to tiny modules. By doing that, it is easier to solve problems in your code and to work in a team on the same codebase. Every module should have exactly one purpose and task to do. A module doesn’t know about the outside logic of your application, and can be reused in different locations and situations.</p>
<p>How do you split up a large feature with lots of tightly connected logic? Let’s do this together.</p>
<pre class=" language-javascript"><code class="javascript  language-javascript"><span class="token comment" spellcheck="true">// This example uses the Fetch API to request an API. Let's assume</span>
<span class="token comment" spellcheck="true">// that it returns a JSON file with some basic content. We then create a</span>
<span class="token comment" spellcheck="true">// new element, count all characters from some fictional content</span>
<span class="token comment" spellcheck="true">// and insert it somewhere in your UI.</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://api.somewebsite.io/post/61454e0126ebb8a2e85d'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> method<span class="token punctuation">:</span> <span class="token string">'GET'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>json <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>json<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>key <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> item <span class="token operator">=</span> json<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> count <span class="token operator">=</span> item<span class="token punctuation">.</span>content<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\s+/gi</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        <span class="token keyword">const</span> el <span class="token operator">=</span> <span class="token template-string"><span class="token string">`
          &lt;div class="foo-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>className<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"&gt;
            &lt;p&gt;Total characters: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>count<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/p&gt;
          &lt;/div&gt;
        `</span></span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> wrapper <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.info-element'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        wrapper<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> el<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>error <span class="token operator">=</span><span class="token operator">&gt;</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>This is not very modular. Everything is tightly connected and dependent on the other pieces. Imagine this with larger, more complex functions and you would have to debug this because something breaks. Maybe the API doesn’t respond, something changed inside of the JSON or whatever. A nightmare, isn’t it?</p>
<p>Let’s separate out the different responsibilities:</p>
<pre class=" language-javascript"><code class="javascript  language-javascript"><span class="token comment" spellcheck="true">// In the previous example we had a function that counted</span>
<span class="token comment" spellcheck="true">// the characters of a string. Let's turn that into a module.</span>
<span class="token keyword">function</span> countCharacters <span class="token punctuation">(</span>text<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> removeWhitespace <span class="token operator">=</span> <span class="token regex">/\s+/gi</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> text<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>removeWhitespace<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// The part where we had a string with some markup in it,</span>
<span class="token comment" spellcheck="true">// is also a proper module now. We use the DOM API to create</span>
<span class="token comment" spellcheck="true">// the HTML, instead of inserting it with a string.</span>
<span class="token keyword">function</span> createWrapperElement <span class="token punctuation">(</span>cssClass<span class="token punctuation">,</span> content<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> className <span class="token operator">=</span> cssClass <span class="token operator">||</span> <span class="token string">'default'</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> wrapperElement <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> textElement <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> textNode <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Total characters: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>content<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  wrapperElement<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>
  textElement<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>textNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
  wrapperElement<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>textElement<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> wrapperElement<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// The anonymous function from the .forEach() method,</span>
<span class="token comment" spellcheck="true">// should also be its own module.</span>
<span class="token keyword">function</span> appendCharacterCount <span class="token punctuation">(</span>config<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wordCount <span class="token operator">=</span> <span class="token function">countCharacters</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> wrapperElement <span class="token operator">=</span> <span class="token function">createWrapperElement</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>className<span class="token punctuation">,</span> wordCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> infoElement <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.info-element'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  infoElement<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>wrapperElement<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Alright, we have three new modules now. Let’s see the refactored <code class=" language-javascript">fetch</code> call.</p>
<pre class=" language-javascript"><code class="javascript  language-javascript"><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://api.somewebsite.io/post/61454e0126ebb8a2e85d'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> method<span class="token punctuation">:</span> <span class="token string">'GET'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>json <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>json<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>key <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">appendCharacterCount</span><span class="token punctuation">(</span>json<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>error <span class="token operator">=</span><span class="token operator">&gt;</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>We could also take the logic from inside the <code class=" language-javascript"><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code> methods and separate that, but I think I have demonstrated what modularization means.</p>
<h3 id="ifmodularizationwhatelse">If <code class=" language-javascript"><span class="token operator">!</span>modularization</code> What Else?</h3>
<p>As I already mentioned, turning your codebase in tiny modules adds another layer of API. If you don’t want that, but want to keep it easier for other developers to work with your code, it’s absolutely fine to keep functions larger. You can still break down your code into simpler portions and focus more on testable code.</p>
<h3 id="documentyourcode">Document Your Code</h3>
<p>Documentation is a heavily discussed topic. One part of the programming community advocates for documenting everything, while another group thinks <a href="http://stackoverflow.com/questions/209015/what-is-self-documenting-code-and-can-it-replace-well-documented-code">self-documenting</a> code is the way to go. As with most things in life, I think a good balance of both makes code readable and scalable. Use <a href="http://usejsdoc.org/">JSDoc</a> for your documentation.</p>
<p>JSDoc is an API documentation generator for JavaScript. It is usually available as a plugin for all well-known editors and IDE’s. Let’s go through an example:</p>
<pre class=" language-javascript"><code class="javascript  language-javascript"><span class="token keyword">function</span> properties <span class="token punctuation">(</span>name<span class="token punctuation">,</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>name<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>key <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> arr<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>This function takes two parameters and iterates over an object, which then returns an array. This might not be an overly complicated method, but for someone who hasn’t written the code it might take a while to figure out what is going on. Additionally, it’s not obvious what the method does. Let’s start documenting:</p>
<pre class=" language-javascript"><code class="javascript  language-javascript"><span class="token comment" spellcheck="true">/**
 * Iterates over an object, pushes all properties matching 'name' into
 * a new array, but only once per occurance.
 * @param  {String}  propertyName - Name of the property you want
 * @param  {Object}  obj          - The object you want to iterate over
 * @return {Array}
 */</span>
<span class="token keyword">function</span> getArrayOfProperties <span class="token punctuation">(</span>propertyName<span class="token punctuation">,</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>propertyName<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> properties <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>child <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>properties<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>child<span class="token punctuation">]</span><span class="token punctuation">[</span>propertyName<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      properties<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>child<span class="token punctuation">]</span><span class="token punctuation">[</span>propertyName<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> properties<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>I haven’t touched much of the code itself. Just by renaming the function and adding a short, yet detailed comment block, we’ve improved the readability.</p>
<h3 id="haveanorganizedcommitworkflow">Have An Organized Commit Workflow</h3>
<p>Refactoring is a huge mission on its own. To be able to always rollback your changes (in case you break something and only notice later), I recommend committing every update you make. Rewrote a method? <code class=" language-javascript">git commit</code> (or <code class=" language-javascript">svn commit</code>, if you work with SVN). Renamed a namespace, folder or a few images? <code class=" language-javascript">git commit</code>. You get the idea. It might be tedious for some people to do, but it really helps you clean up properly and get organized.</p>
<p>Create a new branch for the entire refactoring effort. Don’t ever work on master! You may have to do quick changes or upload bug fixes to the production environment and you don’t want to deploy your (maybe untested) code until it is tested and finished. Hence it is advised to always work on a different branch.</p>
<p>In case you need short update how all this works, there is an <a href="https://guides.github.com/introduction/flow/">interesting guide</a> from GitHub on their version control workflow.</p>
<h2 id="howtonotloseyourmind">How To Not Lose Your Mind</h2>
<p>Besides all the technical steps required for a clean-up, there is one important step I rarely see mentioned anywhere: not being mad at the previous developer. Of course, this doesn’t apply to everyone, but I know that some people experience this. It took me years to really understand this and get over it. I used to get pretty mad at the previous developers code, their solutions and just why everything was such a mess.</p>
<p>In the end, all that negativity never got me anywhere. It only results in you refactoring more than necessary, wasting your time, and maybe breaking things. This just makes you more and more annoyed. You might spend extra hours and nobody will ever thank you for rewriting an already working module. It’s not worth it. Do what is required, analyse the situation. You can always refactor tiny bits every time you go back to a module.</p>
<p>There are always reasons why code is written the way it is. Maybe the previous developer just didn’t have enough time to do it properly, didn’t know better, or whatever. We have all been there.</p>
<h2 id="wrappingitup">Wrapping It Up</h2>
<p>Let’s go over all steps again, to create a checklist for your next project.</p>
<ol>
<li><strong>Analyse the project</strong></li>
</ol>
<ul>
<li>Put your developer hat away for a moment, and be a user to see what it’s all about.</li>
<li>Go through the codebase and make a list of the tools in use.</li>
<li>Read up documentation and best practices of the tools.</li>
<li>Go through the unit tests to get a feeling for the project on a higher level.</li>
</ul>
<ol>
<li><strong>Create a baseline</strong></li>
</ol>
<ul>
<li>Introduce <a href="http://editorconfig.org/"><code class=" language-javascript"><span class="token punctuation">.</span>editorconfig</code></a> to keep the coding style guides consistent between different IDEs.</li>
<li>Make indentation consistent; tabs or spaces, doesn’t matter.</li>
<li>Enforce a naming convention.</li>
<li>If not already present, add a linter like <a href="http://eslint.org/">ESLint</a>, <a href="http://www.jslint.com/">JSLint</a>, or <a href="http://jshint.com/">JSHint</a>.</li>
<li>Update dependencies, but do it wisely and watch out for what exactly has been updated.</li>
</ul>
<ol>
<li><strong>Cleaning up</strong></li>
</ol>
<ul>
<li>Establish unit tests and browser automation with tools like <a href="http://karma-runner.github.io/0.13/index.html">Karma</a>, <a href="http://jasmine.github.io/">Jasmine</a>, or <a href="http://nightwatchjs.org/">Nightwatch.js</a>.</li>
<li>Make sure the architecture and design pattern are consistent.</li>
<li>Don’t mix <a href="https://addyosmani.com/resources/essentialjsdesignpatterns/book/">design patterns</a>, stick to the ones already there.</li>
<li>Decide if you want to split up your codebase into modules. Each should only have one purpose and be unaware of the rest of your codebase logic.</li>
<li>If you don’t want to do that, focus more on testable code and break it down into simpler blocks.</li>
<li>Document your functions and code in a balanced way with properly named functions.</li>
<li>Use <a href="http://usejsdoc.org/">JSDoc</a> to generate documentation for your JavaScript.</li>
<li>Commit regularly and after important changes. If something breaks, it’s easier to go back.</li>
</ul>
<ol>
<li><strong>Don’t lose your mind</strong></li>
</ol>
<ul>
<li>Don’t get mad at the previous developer; negativity will only result in unnecessary refactoring and wasting time.</li>
<li>There have been reasons why code is written like it is. Keep in mind that we’ve all been there.</li>
</ul>
<p>I really hope this article has helped you. Let me know if you struggle with any of the steps, or maybe have some good advice that I didn’t mention!</p>
  